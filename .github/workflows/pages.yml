# ============================================================
# ğŸš€ GOFUNWITH Blog (Chirpy Theme)
# GitHub Actions: Build & Deploy (Stable Version)
# ============================================================

name: Build and Deploy GOFUNWITH Blog

on:
  push:
    branches: [ main ]   # main ë¸Œëœì¹˜ì— pushë  ë•Œë§ˆë‹¤ ìë™ ì‹¤í–‰
  workflow_dispatch:      # ìˆ˜ë™ ì‹¤í–‰ë„ ê°€ëŠ¥

permissions:
  contents: write         # GitHub Pagesì— ë°°í¬ ê¶Œí•œ

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      # ------------------------------------------
      # 1ï¸âƒ£ ì†ŒìŠ¤ ì²´í¬ì•„ì›ƒ (GitHub ì €ì¥ì†Œ ë‚´ìš© ë¶ˆëŸ¬ì˜¤ê¸°)
      # ------------------------------------------
      - name: Checkout repository
        uses: actions/checkout@v4

      # ------------------------------------------
      # 2ï¸âƒ£ Ruby & Jekyll í™˜ê²½ ì„¤ì •
      # ------------------------------------------
      - name: Setup Ruby
        uses: ruby/setup-ruby@v1
        with:
          ruby-version: '3.3'     # Ruby ë²„ì „ ëª…ì‹œ
          bundler-cache: true     # gem ìºì‹œ í™œì„±í™” (ë¹Œë“œ ì†ë„ í–¥ìƒ)

      # ------------------------------------------
      # 3ï¸âƒ£ Jekyll íŒ¨í‚¤ì§€ ì„¤ì¹˜
      # ------------------------------------------
      - name: Install dependencies
        run: bundle install

      # ------------------------------------------
      # 4ï¸âƒ£ ì •ì  ì‚¬ì´íŠ¸ ë¹Œë“œ (Jekyll)
      # ------------------------------------------
      - name: Build site with Jekyll
        run: bundle exec jekyll build --trace
        env:
          JEKYLL_ENV: production

      # ------------------------------------------
      # 5ï¸âƒ£ (ì„ íƒ) HTML-Proofer í…ŒìŠ¤íŠ¸
      # ------------------------------------------
      # âš ï¸ í˜„ì¬ ë¹„í™œì„±í™” ìƒíƒœ â€” ê°œë°œ ì¤‘ì—” êº¼ë‘ì„¸ìš”.
      #     ë§í¬ ê²€ì¦ìœ¼ë¡œ ì¸í•´ false errorê°€ ë°œìƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
      #
      # - name: Test site (HTML-Proofer)
      #   run: bundle exec htmlproofer _site --disable-external
      #
      #     â†³ ë‚˜ì¤‘ì— ìš´ì˜ë‹¨ê³„ì—ì„œë§Œ ì£¼ì„ í•´ì œí•˜ì„¸ìš”.

      # ------------------------------------------
      # 6ï¸âƒ£ GitHub Pagesë¡œ ë°°í¬
      # ------------------------------------------
      - name: Deploy to GitHub Pages
        uses: peaceiris/actions-gh-pages@v3
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          publish_dir: ./_site       # ë¹Œë“œëœ í´ë” (_site) ë°°í¬
          publish_branch: gh-pages   # (ê¸°ë³¸ ì„¤ì •: GitHub Pages ì „ìš© ë¸Œëœì¹˜)

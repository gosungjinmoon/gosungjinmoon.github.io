# ============================================================
# ğŸš€ GOFUNWITH Blog
# GitHub Actions: Build & Deploy
# ============================================================

name: Build and Deploy GOFUNWITH Blog

on:
  push:
    branches: [ main ]
  workflow_dispatch:

permissions:
  contents: write

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest
    steps:
      # 1ï¸âƒ£ ë¦¬í¬ì§€í† ë¦¬ ê°€ì ¸ì˜¤ê¸°
      - name: Checkout repository
        uses: actions/checkout@v4

      # 2ï¸âƒ£ Ruby & Bundler ì„¸íŒ…
      - name: Setup Ruby
        uses: ruby/setup-ruby@v1
        with:
          ruby-version: '3.3'
          bundler-cache: true

      # 3ï¸âƒ£ gem ì„¤ì¹˜
      - name: Install dependencies
        run: bundle install

      # 4ï¸âƒ£ Jekyll ë¹Œë“œ
      - name: Build site with Jekyll
        run: bundle exec jekyll build --trace
        env:
          JEKYLL_ENV: production

      # ------------------------------------------
      # 5ï¸âƒ£ (ì„ íƒ) HTML-Proofer í…ŒìŠ¤íŠ¸
      # ------------------------------------------
      # âš ï¸ í˜„ì¬ ë¹„í™œì„±í™” ìƒíƒœ â€” ê°œë°œ ì¤‘ì—” êº¼ë‘ì„¸ìš”.
      #     ë§í¬ ê²€ì¦ìœ¼ë¡œ ì¸í•´ false errorê°€ ë°œìƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
      #
      # - name: Test site (HTML-Proofer)
      #   run: bundle exec htmlproofer _site --disable-external
      #
      #     â†³ ë‚˜ì¤‘ì— ìš´ì˜ë‹¨ê³„ì—ì„œë§Œ ì£¼ì„ í•´ì œí•˜ì„¸ìš”.

      # ------------------------------------------
      # 6ï¸âƒ£ GitHub Pagesë¡œ ë°°í¬
      # ------------------------------------------
      - name: Deploy to GitHub Pages
        uses: peaceiris/actions-gh-pages@v3
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          publish_branch: gh-pages
          publish_dir: ./_site
          keep_files: false
          force_orphan: true

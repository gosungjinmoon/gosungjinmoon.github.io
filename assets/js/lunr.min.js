/* assets/js/lunr.min.js v1.0.0_202510221638 */
/* lunr.js 2.3.9 minified */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.lunr=t()}(this,function(){return function(e){var t={};function r(n){if(t[n])return t[n].exports;var i=t[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)r.d(n,i,function(t){return e[t]}.bind(null,i));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=0)}([function(e,t,r){!function(n,i){e.exports=i()}(0,function(){var e=function(e){var t=new e.Builder;return t.pipeline.add(e.trimmer,e.stopWordFilter,e.stemmer),t.searchPipeline.add(e.stemmer),e};var t=function(e,t){"function"==typeof define&&define.amd?define(t):"object"==typeof exports?module.exports=t():e.lunr=t()};t(this,function(){return function(){var e,t,r,n,i,o,s,a,l,u,c,h,d,f,p,g,y,m,v,x,w,S,E,b,L,k,O,Q,N,T,C,A,P,R,I,j,U,F,M,D,q,B,H,z,W,K,G,V,J,Y,Z,$,X,ee,te,re,ne,ie,oe,se,ae,le,ue,ce,he,de,fe,pe,ge,ye,me,ve,xe,we,Se,Ee,be,Le,ke,Oe,Qe,Ne,Te,Ce,Ae,Pe,Re,Ie,je,Ue,Fe,Me,De,qe,Be,He,ze,We,Ke,Ge,Ve,Je,Ye,Ze,$e,Xe,et,tt,rt,nt,it,ot,st,at,lt,ut,ct,ht,dt,ft,pt,gt,yt,mt,vt,xt,wt,St,Et,bt,Lt,kt,Ot,Qt,Nt,Tt,Ct,At,Pt,Rt,It,jt,Ut,Ft,Mt,Dt,qt,Bt,Ht,zt,Wt,Kt,Gt,Vt,Jt,Yt,Zt,$t,Xt,er,tr,rr,nr,ir,or,sr,ar,lr,ur,cr,hr,dr,fr,pr,gr,yr,mr,vr,xr,wr,Sr,Er,br,Lr,kr,Or,Qr,Nr,Tr,Cr,Ar,Pr,Rr,Ir,jr,Ur,Fr,Mr,Dr,qr,Br,Hr,zr,Wr,Kr,Gr,Vr,Jr,Yr,Zr,$r,Xr,en,tn,rn,nn,on,sn,an,ln,un,cn,hn,dn,fn,pn,gn,yn,mn,vn,xn,wn,Sn,En,bn,Ln,kn,On,Qn,Nn,Tn,Cn,An,Pn,Rn,In,jn,Un,Fn,Mn,Dn,qn,Bn,Hn,zn,Wn,Kn,Gn,Vn,Jn,Yn,Zn,$n,Xn,ei,ti,ri,ni,ii,oi,si,ai,li,ui,ci,hi,di,fi,pi,gi,yi,mi,vi,xi,wi,Si,Ei,bi,Li,ki,Oi,Qi,Ni,Ti,Ci,Ai,Pi,Ri,Ii,ji,Ui,Fi,Mi,Di,qi,Bi,Hi,zi,Wi,Ki,Gi,Vi,Ji,Yi,Zi,$i,Xi,eo,to,ro,no,io,oo,so,ao,lo,uo,co,ho,do,fo,po,go,yo,mo,vo,xo,wo,So,Eo,bo,Lo,ko,Oo,Qo,No,To,Co,Ao,Po,Ro,Io,jo,Uo,Fo,Mo,Do,qo,Bo,Ho,zo,Wo,Ko,Go,Vo,Jo,Yo,Zo,$o,Xo,es,ts,rs,ns,is,os,ss,as,ls,us,cs,hs,ds,fs,ps,gs,ys,ms,vs,xs,ws,Ss,Es,bs,Ls,ks,Os,Qs,Ns,Ts,Cs,As,Ps,Rs,Is,js,Us,Fs,Ms,Ds,qs,Bs,Hs,zs,Ws,Ks,Gs,Vs,Js,Ys,Zs,$s,Xs,ea,ta,ra,na,ia,oa,sa,aa,la,ua,ca,ha,da,fa,pa,ga,ya,ma,va,xa,wa,Sa,Ea,ba,La,ka,Oa,Qa,Na,Ta,Ca,Aa,Pa,Ra,Ia,ja,Ua,Fa,Ma,Da,qa,Ba,Ha,za,Wa,Ka,Ga,Va,Ja,Ya,Za,$a,Xa,el,tl,rl,nl,il,ol,sl,al,ll,ul,cl,hl,dl,fl,pl,gl,yl,ml,vl,xl,wl,Sl,El,bl,Ll,kl,Ol,Ql,Nl,Tl,Cl,Al,Pl,Rl,Il,jl,Ul,Fl,Ml,Dl,ql,Bl,Hl,zl,Wl,Kl,Gl,Vl,Jl,Yl,Zl,$l,Xl,eu,tu,ru,nu,iu,ou,su,au,lu,uu,cu,hu,du,fu,pu,gu,yu,mu,vu,xu,wu,Su,Eu,bu,Lu,ku,Ou,Qu,Nu,Tu,Cu,Au,Pu,Ru,Iu,ju,Uu,Fu,Mu,Du,qu,Bu,Hu,zu,Wu,Ku,Gu,Vu,Ju,Yu,Zu,$u,Xu,ec,tc,rc,nc,ic,oc,sc,ac,lc,uc,cc,hc,dc,fc,pc,gc,yc,mc,vc,xc,wc,Sc,Ec,bc,Lc,kc,Oc,Qc,Nc,Tc,Cc,Ac,Pc,Rc,Ic,jc,Uc,Fc,Mc,Dc,qc,Bc,Hc,zc,Wc,Kc,Gc,Vc,Jc,Yc,Zc,$c,Xc,eh,th,rh,nh,ih,oh,sh,ah,lh,uh,ch,hh,dh,fh,ph,gh,yh,mh,vh,xh,wh,Sh,Eh,bh,Lh,kh,Oh,Qh,Nh,Th,Ch,Ah,Ph,Rh,Ih,jh,Uh,Fh,Mh,Dh,qh,Bh,Hh,zh,Wh,Kh,Gh,Vh,Jh,Yh,Zh,$h,Xh,ed,td,rd,nd,id,od,sd,ad,ld,ud,cd,hd,dd,fd,pd,gd,yd,md,vd,xd,wd,Sd,Ed,bd,Ld,kd,Od,Qd,Nd,Td,Cd,Ad,Pd,Rd,Id,jd,Ud,Fd,Md,Dd,qd,Bd,Hd,zd,Wd,Kd,Gd,Vd,Jd,Yd,Zd,$d,Xd,ef,tf,rf,nf,f,of,sf,af,lf,uf,cf,hf,df,ff,pf,gf,yf,mf,vf,xf,wf,Sf,Ef,bf,Lf,kf,Of,Qf,Nf,Tf,Cf,Af,Pf,Rf,If,jf,Uf,Ff,Mf,Df,qf,Bf,Hf,zf,Wf,Kf,Gf,Vf,Jf,Yf,Zf,$f,Xf,ep,tp,rp,np,ip,op,sp,ap,lp,up,cp,hp,dp,fp,pp,gp,yp,mp,vp,xp,wp,Sp,Ep,bp,Lp,kp,Op,Qp,Np,Tp,Cp,Ap,Pp,Rp,Ip,jp,Up,Fp,Mp,Dp,qp,Bp,Hp,zp,Wp,Kp,Gp,Vp,Jp,Yp,Zp,$p,Xp,eg,tg,rg,ng,ig,og,sg,ag,lg,ug,cg,hg,dg,fg,pg,gg,yg,mg,vg,xg,wg,Sg,Eg,bg,Lg,kg,Og,Qg,Ng,Tg,Cg,Ag,Pg,Rg,Ig,jg,Ug,Fg,Mg,Dg,qg,Bg,Hg,zg,Wg,Kg,Gg,Vg,Jg,Yg,Zg,$g,Xg,ey,ty,ry,ny,iy,oy,sy,ay,ly,uy,cy,hy,dy,fy,py,gy,yy,my,vy,xy,wy,Sy,Ey,by,Ly,ky,Oy,Qy,Ny,Ty,Cy,Ay,Py,Ry,Iy,jy,Uy,Fy,My,Dy,qy,By,Hy,zy,Wy,Ky,Gy,Vy,Jy,Yy,Zy,$y,Xy,em,tm,rm,nm,im,om,sm,am,lm,um,cm,hm,dm,fm,pm,gm,ym,mm,vm,xm,wm,Sm,Em,bm,Lm,km,Om,Qm,Nm,Tm,Cm,Am,Pm,Rm,Im,jm,Um,Fm,Mm,Dm,qm,Bm,Hm,zm,Wm,Km,Gm,Vm,Jm,Ym,Zm,$m,Xm,ev,tv,rv,nv,iv,ov,sv,av,lv,uv,cv,hv,dv,fv,pv,gv,yv,mv,vv,xv,wv,Sv,Ev,bv,Lv,kv,Ov,Qv,Nv,Tv,Cv,Av,Pv,Rv,Iv,jv,Uv,Fv,Mv,Dv,qv,Bv,Hv,zv,Wv,Kv,Gv,Vv,Jv,Yv,Zv,$v,Xv,ex,tx,rx,nx,ix,ox,sx,ax,lx,ux,cx,hx,dx,fx,px,gx,yx,mx,vx,xx,wx,Sx,Ex,bx,Lx,kx,Ox,Qx,Nx,Tx,Cx,Ax,Px,Rx,Ix,jx,Ux,Fx,Mx,Dx,qx,Bx,Hx,zx,Wx,Kx,Gx,Vx,Jx,Yx,Zx,$x,Xx,ew,tw,rw,nw,iw,ow,sw,aw,lw,uw,cw,hw,dw,fw,pw,gw,yw,mw,vw,xw,ww,Sw,Ew,bw,Lw,kw,Ow,Qw,Nw,Tw,Cw,Aw,Pw,Rw,Iw,jw,Uw,Fw,Mw,Dw,qw,Bw,Hw,zw,Ww,Kw,Gw,Vw,Jw,Yw,Zw,$w,Xw,eS,tS,rS,nS,iS,oS,sS,aS,lS,uS,cS,hS,dS,fS,pS,gS,yS,mS,vS,xS,wS,SS,ES,bS,LS,kS,OS,QS,NS,TS,CS,AS,PS,RS,IS,jS,US,FS,MS,DS,qS,BS,HS,zS,WS,KS,GS,VS,JS,YS,ZS,$S,XS,eE,tE,rE,nE,iE,oE,sE,aE,lE,uE,cE,hE,dE,fE,pE,gE,yE,mE,vE,xE,wE,SE,EE,bE,LE,kE,OE,QE,NE,TE,CE,AE,PE,RE,IE,jE,UE,FE,ME,DE,qE,BE,HE,zE,WE,KE,GE,VE,JE,YE,ZE,$E,XE,eL,tL,rL,nL,iL,oL,sL,aL,lL,uL,cL,hL,dL,fL,pL,gL,yL,mL,vL,xL,wL,SL,EL,bL,LL,kL,OL,QL,NL,TL,CL,AL,PL,RL,IL,jL,UL,FL,ML,DL,qL,BL,HL,zL,WL,KL,GL,VL,JL,YL,ZL,$L,XL,ek,tk,rk,nk,ik,ok,sk,ak,lk,uk,ck,hk,dk,fk,pk,gk,yk,mk,vk,xk,wk,Sk,Ek,bk,Lk,kk,Ok,Qk,Nk,Tk,Ck,Ak,Pk,Rk,Ik,jk,Uk,Fk,Mk,Dk,qk,Bk,Hk,zk,Wk,Kk,Gk,Vk,Jk,Yk,Zk,$k,Xk,eO,tO,rO,nO,iO,oO,sO,aO,lO,uO,cO,hO,dO,fO,pO,gO,yO,mO,vO,xO,wO,SO,EO,bO,LO,kO,OO,QO,NO,TO,CO,AO,PO,RO,IO,jO,UO,FO,MO,DO,qO,BO,HO,zO,WO,KO,GO,VO,JO,YO,ZO,$O,XO,eQ,tQ,rQ,nQ,iQ,oQ,sQ,aQ,lQ,uQ,cQ,hQ,dQ,fQ,pQ,gQ,yQ,mQ,vQ,xQ,wQ,SQ,EQ,bQ,LQ,kQ,OQ,QQ,NQ,TQ,CQ,AQ,PQ,RQ,IQ,jQ,UQ,FQ,MQ,DQ,qQ,BQ,HQ,zQ,WQ,KQ,GQ,VQ,JQ,YQ,ZQ,$Q,XQ,eN,tN,rN,nN,iN,oN,sN,aN,lN,uN,cN,hN,dN,fN,pN,gN,yN,mN,vN,xN,wN,SN,EN,bN,LN,kN,ON,QN,NN,TN,CN,AN,PN,RN,IN,jN,UN,FN,MN,DN,qN,BN,HN,zN,WN,KN,GN,VN,JN,YN,ZN,$N,XN,eT,tT,rT,nT,iT,oT,sT,aT,lT,uT,cT,hT,dT,fT,pT,gT,yT,mT,vT,xT,wT,ST,ET,bT,LT,kT,OT,QT,NT,TT,CT,AT,PT,RT,IT,jT,UT,FT,MT,DT,qT,BT,HT,zT,WT,KT,GT,VT,JT,YT,ZT,$T,XT,eC,tC,rC,nC,iC,oC,sC,aC,lC,uC,cC,hC,dC,fC,pC,gC,yC,mC,vC,xC,wC,SC,EC,bC,LC,kC,OC,QC,NC,TC,CC,AC,PC,RC,IC,jC,UC,FC,MC,DC,qC,BC,HC,zC,WC,KC,GC,VC,JC,YC,ZC,$CRequest,XC,eA,tA,rA,nA,iA,oA,sA,aA,lA,uA,cA,hA,dA,fA,pA,gA,yA,mA,vA,xA,wA,SA,EA,bA,LA,kA,OA,QA,NA,TA,CA,AA,PA,RA,IA,jA,UA,FA,MA,DA,qA,BA,HA,zA,WA,KA,GA,VA,JA,YA,ZA,$A,XA,eP,tP,rP,nP,iP,oP,sP,aP,lP,uP,cP,hP,dP,fP,pP,gP,yP,mP,vP,xP,wP,SP,EP,bP,LP,kP,OP,QP,NP,TP,CP,AP,PP,RP,IP,jP,UP,FP,MP,DP,qP,BP,HP,zP,WP,KP,GP,VP,JP,YP,ZP,$PC,XP,eR,tR,rR,nR,iR,oR,sR,aR,lR,uR,cR,hR,dR,fR,pR,gR,yR,mR,vR,xR,wR,SR,ER,bR,LR,kR,OR,QR,NR,TR,CR,AR,PR,RR,IR,jR,UR,FR,MR,DR,qR,BR,HR,zR,WR,KR,GR,VR,JR,YR,ZR,$R,XR,eI,tI,rI,nI,iI,oI,sI,aI,lI,uI,cI,hI,dI,fI,pI,gI,yI,mI,vI,xI,wI_autoDetectLanguage,SI,EI,bI,LI,kI,OI,QI,NI,TI,CI,AI,PI,RI,II,jI,UI,FI,MI,DI,qI,BI,HI,zI,WI,KI,GI,VI,JI,YI,ZI,$I,XI,ej,tj,rj,nj,ij,oj,sj,aj,lj,uj,cj,hj,dj,fj,pj,gj,yj,mj,vj,xj,wj,Sj,Ej,bj,Lj,kj,Oj,Qj,Nj,Tj,Cj,Aj,Pj,Rj,Ij,jj,Uj,Fj,Mj,Dj,qj,Bj,Hj,zj,Wj,Kj,Gj,Vj,Jj,Yj,Zj,$j,Xj,eU,tU,rU,nU,iU,oU,sU,aU,lU,uU,cU,hU,dU,fU,pU,gU,yU,mU,vU,xU,wU,SU,EU,bU,LU,kU,OU,QU,NU,TU,CU,AU,PU,RU,IU,jU,UU,FU,MU,DU,qU,BU,HU,zU,WU,KU,GU,VU,JU,YU,ZU,$U,XU,eF,tF,rF,nF,iF,oF,sF,aF,lF,uF,cF,hF,dF,fF,pF,gF,yF,mF,vF,xF,wF,SF,EF,bF,LF,kF,OF,QF,NF,TF,CF,AF,PF,RF,IF,jF,UF,FF,MF,DF,qF,BF,HF,zF,WF,KF,GF,VF,JF,YF,ZF,$F,XF,eM,tM,rM,nM,iM,oM,sM,aM,lM,uM,cM,hM,dM,fM,pM,gM,yM,mM,vM,xM,wM,SM,EM,bM,LM,kM,OM,QM,NM,TM,CM,AM,PM,RM,IM,jM,UM,FM,MM,DM,qM,BM,HM,zM,WM,KM,GM,VM,JM,YM,ZM,$MAdjustments,XM,eD,tD,rD,nD,iD,oD,sD,aD,lD,uD,cD,hD,dD,fD,pD,gD,yD,mD,vD,xD,wD,SD,ED,bD,LD,kD,OD,QD,ND,TD,CD,AD,PD,RD,ID,jD,UD,FD,MD,DD,qD,BD,HD,zD,WD,KD,GD,VD,JD,YD,ZD,$D,XD,eq,tq,rq,nq,iq,oq,sq,aq,lq,uq,cq,hq,dq,fq,pq,gq,yq,mq,vq,xq,wq,Sq,Eq,bq,Lq,kq,Oq,Qq,Nq,Tq,Cq,Aq,Pq,Rq,Iq,jq,Uq,Fq,Mq,Dq,qq,Bq,Hq,zq,Wq,Kq,Gq,Vq,Jq,Yq,Zq,$q,Xq,eB,tB,rB,nB,iB,oB,sB,aB,lB,uB,cB,hB,dB,fB,pB,gB,yB,mB,vB,xB,wB,SB,EB,bB,LB,kB,OB,QB,NB,TB,CB,AB,PB,RB,IB,jB,UB,FB,MB,DB,qB,BB,HB,zB,WB,KB,GB,VB,JB,YB,ZB,$B,XB,eH,tH,rH,nH,iH,oH,sH,aH,lH,uH,cH,hH,dH,fH,pH,gH,yH,mH,vH,xH,wH,SH,EH,bH,LH,kH,OH,QH,NH,TH,CH,AH,PH,RH,IH,jH,UH,FH,MH,DH,qH,BH,HH,zH,WH,KH,GH,VH,JH,YH,ZH,$H,XH,ez,tz,rz,nz,iz,oz,sz,az,lz,uz,cz,hz,dz,fz,pz,gz,yz,mz,vz,xz,wz,Sz,Ez,bz,Lz,kz,Oz,Qz,Nz,Tz,Cz,Az,Pz,Rz,Iz,jz,Uz,Fz,Mz,Dz,qz,Bz,Hz,zz,Wz,Kz,Gz,Vz,Jz,Yz,Zz,$z,Xz,eW,tW,rW,nW,iW,oW,sW,aW,lW,uW,cW,hW,dW,fW,pW,gW,yW,mW,vW,xW,wW,SW,EW,bW,LW,kW,OW,QW,NW,TW,CW,AW,PW,RW,IW,jW,UW,FW,MW,DW,qW,BW,HW,zW,WW,KW,GW,VW,JW,YW,ZW,$W,XW,eK,tK,rK,nK,iK,oK,sK,aK,lK,uK,cK,hK,dK,fK,pK,gK,yK,mK,vK,xK,wK,SK,EK,bK,LK,kK,OK,QK,NK,TK,CK,AK,PK,RK,IK,jK,UK,FK,MK,DK,qK,BK,HK,zK,WK,KK,GK,VK,JK,YK,ZK,$K,XK,eG,tG,rG,nG,iG,oG,sG,aG,lG,uG,cG,hG,dG,fG,pG,gG,yG,mG,vG,xG,wG,SG,EG,bG,LG,kG,OG,QG,NG,TG,CG,AG,PG,RG,IG,jG,UG,FG,MG,DG,qG,BG,HG,zG,WG,KG,GG,VG,JG,YG,ZG,$GCheck,XG,eV,tV,rV,nV,iV,oV,sV,aV,lV,uV,cV,hV,dV,fV,pV,gV,yV,mV,vV,xV,wV,SV,EV,bV,LV,kV,OV,QV,NV,TV,CV,AV,PV,RV,IV,jV,UV,FV,MV,DV,qV,BV,HV,zV,WV,KV,GV,VV,JV,YV,ZV,$V,XV,eJ,tJ,rJ,nJ,iJ,oJ,sJ,aJ,lJ,uJ,cJ,hJ,dJ,fJ,pJ,gJ,yJ,mJ,vJ,xJ,wJ,SJ,EJ,bJ,LJ,kJ,OJ,QJ,NJ,TJ,CJ,AJ,PJ,RJ,IJ,jJ,UJ,FJ,MJ,DJ,qJ,BJ,HJ,zJ,WJ,KJ,GJ,VJ,JJ,YJ,ZJ,$J,XJ,eY,tY,rY,nY,iY,oY,sY,aY,lY,uY,cY,hY,dY,fY,pY,gY,yY,mY,vY,xY,wY,SY,EY,bY,LY,kY,OY,QY,NY,TY,CY,AY,PY,RY,IY,jY,UY,FY,MY,DY,qY,BY,HY,zY,WY,KY,GY,VY,JY,YY,ZY,$Y,XY,eZ,tZ,rZ,nZ,iZ,oZ,sZ,aZ,lZ,uZ,cZ,hZ,dZ,fZ,pZ,gZ,yZ,mZ,vZ,xZ,wZ,SZ,EZ,bZ,LZ,kZ,OZ,QZ,NZ,TZ,CZ,AZ,PZ,RZ,IZ,jZ,UZ,FZ,MZ,DZ,qZ,BZ,HZ,zZ,WZ,KZ,GZ,VZ,JZ,YZ,ZZ,$Z,XZ,e$,t$,r$,n$,i$,o$,s$,a$,l$,u$,c$,h$,d$,f$,p$,g$,y$,m$,v$,x$,w$,S$,E$,b$,L$,k$,O$,Q$,N$,T$,C$,A$,P$,R$,I$,j$,U$,F$,M$,D$,q$,B$,H$,z$,W$,K$,G$,V$,J$,Y$,Z$,$$,X$,eX,tX,rX,nX,iX,oX,sX,aX,lX,uX,cX,hX,dX,fX,pX,gX,yX,mX,vX,xX,wX,SX,EX,bX,LX,kX,OX,QX,NX,TX,CX,AX,PX,RX,IX,jX,UX,FX,MX,DX,qX,BX,HX,zX,WX,KX,GX,VX,JX,YX,ZX,$X,XX;return e={version:"2.Change",Builder:function(){this._ref="id",this._fields={},this._documents={},this.tokenizer=U,this.pipeline=new Yt,this.searchPipeline=new Yt,this.documentCount=0,this._b=.75,this._k1=1.2,this.termIndex=0,this.metadataWhitelist=[]},FieldRef:function(e,t,r){this.docRef=e,this.fieldName=t,this._score=r},MatchData:function(e,t,r){this.metadata=r||{},this.metadata[e]=Object.keys(t).reduce(function(e,r){return e[r]=t[r].slice(),e},{}),Object.freeze(this.metadata),Object.defineProperty(this,"terms",{value:Object.keys(this.metadata)}),Object.defineProperty(this,"queryTerms",{value:this.terms.filter(function(e){return Object.keys(this.metadata[e]).some(function(e){return this.metadata[e].position}.bind(this))}.bind(this))})},Query:function(e){this.clauses=e.slice()},QueryLexer:e=function(){function e(e){return"number"==typeof e?e:e.charCodeAt(0)-96}this.lex=function(t){var r=new e.QueryLexer(t),n=[],i=e.QueryLexer.STATES.FIELD;return r.run(function(e,t,o){n.push({type:e,str:t,start:o,end:r.pos})}),n}},QueryParser:t=function(){function e(e){return new t.QueryParser(e)}this.parse=function(t){"string"==typeof t&&(t=this.lexer.lex(t));var r=this.clauses,n=this.currentClause,i=[];return t.forEach(function(t,o,s){var a=t.type;switch(a){case e.QueryLexer.TYPES.FIELD:i.push(t.str);break;case e.QueryLexer.TYPES.TERM:this.parseTerm(t,i);break;case e.QueryLexer.TYPES.PRESENCE:this.parsePresence(t,i);break;case e.QueryLexer.TYPES.BOOST:this.parseBoost(t,i);break;case e.QueryLexer.TYPES.EDIT_DISTANCE:this.parseEditDistance(t,i);break;case e.QueryLexer.TYPES.EOS:this.parseTerm(t,i);break;default:throw new Error("Unexpected lexer type: "+a)}i=[]}.bind(this)),r.length>1&&r.slice(1).forEach(function(e){e.presence==e.constructor.PRESENCE.PROHIBITED&&(e.presence=e.constructor.PRESENCE.REQUIRED)}),new e.Query(r)},this.parseTerm=function(t,r){var i=this.currentClause,s=t.str.toLowerCase();if(""!==s){i.term=s;var a={};a[s]={};var l=new e.MatchData(s,a);i.matchData=l,t.str.indexOf("*")!==-1&&(i.wildcard=e.Query.WILDCARD.TRAILING);var u=t.str.length-1;t.str.charAt(u)=="*"?u>0&&t.str.charAt(u-1)=="*"?(i.wildcard=e.Query.WILDCARD.LEADING|e.Query.WILDCARD.TRAILING,i.term=t.str.slice(1,u)):(i.wildcard=e.Query.WILDCARD.TRAILING,i.term=t.str.slice(0,u)):t.str.charAt(0)=="*"&&(i.wildcard=e.Query.WILDCARD.LEADING,i.term=t.str.slice(1)),r.length&&(i.fields=r),this.clauses.push(i),this.currentClause=new e.Query.Clause}},this.parsePresence=function(t,r){var n=t.str;switch(n){case"-":this.currentClause.presence=e.Query.Clause.PRESENCE.PROHIBITED;break;case"+":this.currentClause.presence=e.Query.Clause.PRESENCE.REQUIRED;break;default:throw new Error("Unexpected presence operator '"+n+"'")}r.length&&(this.currentClause.fields=r)},this.parseBoost=function(t,r){var n=parseInt(t.str,10);if(isNaN(n))throw new Error("Invalid boost '"+t.str+"'");this.currentClause.boost=n,r.length&&(this.currentClause.fields=r)},this.parseEditDistance=function(t,r){var n=parseInt(t.str,10);if(isNaN(n))throw new Error("Invalid edit distance '"+t.str+"'");this.currentClause.editDistance=n,r.length&&(this.currentClause.fields=r)}},Index:r=function(){function e(e,t){return new r.Index(e,t)}this.search=function(t){return this.query(function(r){var n=new e.QueryParser(r);n.parse(t)}.bind(this))},this.query=function(t){var r=new e.Query(this.fields),n=Object.create(null),i=Object.create(null),o=Object.create(null),s=Object.create(null),a=Object.create(null);return t.call(r,r),r.clauses.forEach(function(t,r){var a=this.resolveClause(t);a.size>0&&(i[r]=a)}.bind(this)),r.clauses.forEach(function(t,r){var l=i[r];if(l){t.presence==e.Query.Clause.PRESENCE.REQUIRED&&this.applyPresence(n,l,r),t.presence==e.Query.Clause.PRESENCE.PROHIBITED&&this.applyProhibition(o,l,r);var u=t.boost;l.forEach(function(e,t,i){var a=this.documentStore.get(t);this.fieldStore.intersect(e,t,function(e,t,r){var l=this.idf(e,r),c=1;Object.keys(this.fieldStore.get(t)).forEach(function(n){Object.keys(this.fieldStore.get(t)[n]).forEach(function(t){this.fieldStore.get(t)[n][t].position&&this.fieldStore.get(t)[n][t].position.forEach(function(i){var o=this.fieldVectors[n].get(i);if(o){var a=this.fieldStore.get(t)[n][t].position.length/o;c=Math.min(c,a)}}.bind(this))}.bind(this))}.bind(this));var d=this.fieldStore.getTermFrequency(e,t,r);if(1==u||void 0===u)u=1;var f=this.fieldStore.get(t).magnitude/this.documentStore.get(t).magnitude;if(void 0===s[t]){s[t]=0,n[t]=1}s[t]+=(u*l*d*(this._k1+1))/(d+this._k1*(1-this._b+this._b*f))*c}.bind(this))}.bind(this))}.bind(this)),this.coordinate(n,s),Object.keys(n).filter(function(e){return!(e in o)}.bind(this)).map(function(e){return{ref:e,score:s[e],matchData:a[e]}}.bind(this)).sort(function(e,t){return t.score-e.score})},this.resolveClause=function(t){var r,n,i=new e.Vector,o=!0;t.wildcard&(o=!1);var s=t.term;return o||(s=this.tokenSet.toArray().filter(function(e){return this.tokenSet.edges[e].str.indexOf(t.term)!==-1},this)),s.forEach(function(o){var s=this.tokenSet.fromString(o),a=!1;if(s==e.Token.WILDCARD)return;o.indexOf("*")!==-1&&(a=!0);var l=this.invertedIndex.get(s);l&&(t.fields?t.fields.forEach(function(e,t,r){var n=l[e];n&&i.add(n)}.bind(this)):i.add(l.docs),i.forEach(function(e,t,r){i.add(r)}.bind(this)))}.bind(this)),r=i,n=t.editDistance,r.reduce(function(t,r,i){var o=r-i[0],s=i[1],a=Math.ceil(s/o),l=Math.floor(s/o);a>n&&(t=t.add([l,s])),t=t.add(i);for(var u=o-1;u>=1;u--){var c=Math.ceil((s-u)/o),h=Math.floor((s+u)/o);c>n||(t=t.add([c,s]),t=t.add([h,s]))}return t},new e.Vector)},this.applyPresence=function(e,t,r){t.forEach(function(t,i,o){e[i]=(e[i]||0)+1}.bind(this))},this.applyProhibition=function(e,t,r){t.forEach(function(t,i,o){e[i]=1}.bind(this))},this.coordinate=function(e,t){var r=Object.keys(e).length;Object.keys(t).forEach(function(n){t[n]=t[n]*e[n]/r}.bind(this))}},Token:function(e,t){this.str=e||"",this.metadata=t||{},this.string="["+this.str+"]",Object.freeze(this)},TokenSet:i=function(){function e(e){return new i.TokenSet(e)}this.add=function(t){var r=!0;return t.forEach(function(t){r=this.insert(t)&&r},this),r},this.toArray=function(){return this.root.toArray().map(function(e){return this.edges[e].str})},this.toString=function(){return this.toArray().join(",")},this.intersect=function(t){var r=new e,n=Object.keys(this.edges).sort(),i=Object.keys(t.edges).sort(),o=n.length,s=i.length,a=0,l=0;for(;(a<o)&&(l<s);){var u=n[a],c=i[l],h=this.edges[u].str,d=t.edges[c].str;h<d?a++:h>d?l++:(h==d&&r.add(d),a++,l++)}return r}},Vector:o=function(){function e(e){return new o(e)}this.add=function(t){return this.insert(t[0],t[1]),this},this.reduce=function(e,t){if(0==this.length)return t;var r=this.elements.slice().sort(function(e,t){return e[0]-t[0]});t=e(t,r[0],0,r);for(var n=1;n<r.length;n++)t=e(t,r[n],n,r);return t},this.forEach=function(e,t){if(0!=this.length){t=t||this;for(var r=0;r<this.length;r++){var n=this.elements[r];e.call(t,n[1],n[0],n)}}}},DocumentStore:function(){this.docs={},this.docInfo={},this.length=0,this.add=function(e,t){this.docs[e.ref]||this.length++,this.docs[e.ref]=e,this.docInfo[e.ref]=t},this.get=function(e){return this.docs[e]},this.has=function(e){return e in this.docs},this.remove=function(e){this.has(e)&&(delete this.docs[e],delete this.docInfo[e],this.length--)},this.getDocInfo=function(e){return this.docInfo[e]},this.getDocInfos=function(){return this.docInfo}},FieldStore:function(){this.fields={},this.tf={},this.errors={},this.add=function(e,t,r,n){this.fields[e]||(this.fields[e]=Object.create(null)),this.fields[e][t]||(this.fields[e][t]=Object.create(null)),this.fields[e][t][r]||(this.fields[e][t][r]=Object.create(null));var i=0;n.forEach(function(e,t,r){i+=e},this),this.fields[e][t][r].length=i,this.fields[e][t][r].position=n.map(function(e,t,r){return[e,r[t+1]-r[t-1]||1]}).slice(0,n.length/2)},this.get=function(e){return this.fields[e]},this.has=function(e,t,r){return!!this.fields[e]&&!!this.fields[e][t]&&!!this.fields[e][t][r]},this.getTermFrequency=function(e,t,r){return this.fields[e]&&this.fields[e][t]&&this.fields[e][t][r]?this.fields[e][t][r].length:0},this.getTermPositions=function(e,t,r){return this.fields[e]&&this.fields[e][t]&&this.fields[e][t][r]?this.fields[e][t][r].position.slice():[]},this.intersect=function(e,t,r,n){n=n||Object.create(null),this.fields[e]&&Object.keys(this.fields[e]).forEach(function(i){this.fields[e][i][t]&&r(i,t,e)},this)},this.store=function(e,t,r){if(!this.fields[t]||!this.fields[t][r])return null;var n=this.fields[t][r];return n?{magnitude:Math.sqrt(Object.keys(n).reduce(function(e,t){return e+n[t].length*n[t].length},0)),docRef:r}:null},this.calculateFieldVectors=function(e){var t={},r=this.fields;Object.keys(r).forEach(function(n){var i=r[n];Object.keys(i).forEach(function(r){var n=i[r];Object.keys(n).forEach(function(i){t[i]||(t[i]=new e),t[i].insert(this.termIndex,n[i].length)}.bind(this)),this.termIndex++}.bind(this))}.bind(this));var n=Object.create(null);return Object.keys(t).forEach(function(e){n[e]=t[e].magnitude},this),{fieldVectors:t,fieldLengths:n}},this.remove=function(e){Object.keys(this.fields).forEach(function(t){Object.keys(this.fields[t]).forEach(function(r){delete this.fields[t][r][e]})}.bind(this))}},InvertedIndex:function(){this.root={docs:{},df:0},this.add=function(e,t){var r=this.root,n=0;e.forEach(function(e,i){var o=e.str;r[o]||(r[o]={docs:{},df:0});var s=0;Object.keys(t.fields).forEach(function(e){var r=t.fields[e];r.indexOf(i)!==-1&&(s=1)});for(var a=0;a<e.str.length;a++)r=r[e.str[a]]||(r[e.str[a]]={docs:{},df:0});r.docs[t.ref]=s,n=1}.bind(this)),r.df+=n},this.get=function(e){var t=this.root,r=e.str;try{for(var n=0;n<r.length;n++)t=t[r[n]]}catch(e){return null}return t},this.has=function(e){var t=this.root,r=e.str;try{for(var n=0;n<r.length;n++)t=t[r[n]]}catch(e){return!1}return!0},this.remove=function(e,t){var r=this.root;e.forEach(function(e){var n=e.str;try{for(var i=0;i<n.length;i++)r=r[n[i]];var o=Object.keys(r.docs);delete r.docs[t],o.length-1==0&&(r.df=0)}catch(e){return}}.bind(this))},this.getNode=function(e){var t=this.root,r=e.str;try{for(var n=0;n<r.length;n++)t=t[r[n]];return t}catch(r){return e.metadata.wildcard||null}},this.expand=function(e,t){var r=this.getNode(e);return r?Object.keys(r.docs).length>0?[e]:t:Object.keys(r).filter(function(e){return"docs"!=e&&"df"!=e}).reduce(function(t,n){return t.concat(this.expand(new e.constructor(e.str+n,e.metadata),r[n]))}.bind(this),[])}},Pipeline:s=function(){function e(e){return new s(e)}this.add=function(){var e=Array.prototype.slice.call(arguments);e.forEach(function(e){this.registerFunction(e),this._stack.push(e)},this)},this.after=function(e,t){this.registerFunction(t);var r=this._stack.indexOf(e);if(r==-1)throw new Error("Cannot find existingFn");r+=1,this._stack.splice(r,0,t)},this.before=function(e,t){this.registerFunction(t);var r=this.stack.indexOf(e);if(r==-1)throw new Error("Cannot find existingFn");this._stack.splice(r,0,t)},this.remove=function(e){var t=this._stack.indexOf(e);t!==-1&&this._stack.splice(t,1)},this.run=function(e){for(var t=[],r=e.length,n=this._stack.length,i=0;i<r;i++){for(var o=e[i],s=0;s<n&&(o=this._stack[s](o,i,e),void 0!==o&&""!==o);s++);void 0!==o&&""!==o&&t.push(o)}return t},this.runString=function(e,t){var r=new this.tokenizer(e,t);return this.run(r)},this.reset=function(){this._stack=[]},this.toJSON=function(){return this._stack.map(function(t){return e.Pipeline.registeredFunctions[t.label]})},this.registerFunction=function(t,r){if("function"!=typeof t)throw new Error("Check your maps, you provided a function that is not actually a function");t.label&&e.Pipeline.registeredFunctions[t.label]||(t.label=r||this.serialiseCounter++,e.Pipeline.registeredFunctions[t.label]=t)}},tokenizer:function(e,t){if(null==e||void 0==e)return[];if(Array.isArray(e))return e.map(function(e){return new this.Token(e.toLowerCase(),t)});for(var r=e.toString().toLowerCase(),n=r.length,i=0,o=[],s=0,a=0;i<=n;i++){var l=r.charAt(i),u=i-s;if(l.match(this.tokenizer.separator)||i==n){if(u>0){var c=new this.Token(r.slice(s,i),t);c.metadata.position=[s,u],c.metadata.index=a++,o.push(c)}s=i+1}}return o},Vector:function(e){this.elements=e||[],this.length=this.elements.length,this.insert=function(e,t){if(0==this.length)return this.elements.push([e,t]),void(this.length=1);var r=this.elements.length-1,n=this.elements[r];n[0]<e?this.elements.push([e,t]):n[0]>e?this_s.elements.unshift([e,t]):n[1]=t,this.length=this.elements.length},this.magnitude=function(){if(this._magnitude)return this._magnitude;if(0==this.length)return this._magnitude=0;for(var e=0,t=this.length,r=0;r<t;r++){var n=this.elements[r][1];e+=n*n}return this._magnitude=Math.sqrt(e)}},idf:function(e,t){var r=0;return this.fieldStore.intersect(e,t,function(e,t,r){r.df&&(r.df>0?r=r.df:r=1,r+=1,r=1+Math.log(this.documentStore.length/r),r>0?r:r=1e-6)}),r},trimmer:a=function(e,t,r){return e.str=e.str.replace(/^\W+/,"").replace(/\W+$/,""),e},stopWordFilter:l=function(e,t,r){return l.stopWords.has(e.str)?void 0:e},stemmer:u=function(){var e={ational:"ate",tional:"tion",enci:"ence",anci:"ance",izer:"ize",bli:"ble",alli:"al",entli:"ent",eli:"e",ousli:"ous",ization:"ize",ation:"ate",ator:"ate",alism:"al",iveness:"ive",fulness:"ful",ousness:"ous",aliti:"al",iviti:"ive",biliti:"ble",logi:"log"},t={icate:"ic",ative:"",alize:"al",iciti:"ic",ical:"ic",ful:"",ness:""},r="([aeiouy][^aeiouy]*)?([aeiouy][^aeiouy]*[aeiouy])",n=new RegExp("^("+r+")?"+r+"(.[^aeiouy])?(.*)$"),i=/^([a-z])\1+$/,o=/^([a-z])\1+/,s=new RegExp("([^aeiouy])y$"),a=new RegExp("((.[^aeiouy])[aeiouy])(.[^aeiouy])?$"),l=new RegExp("^(.*[^aeiouy])(ing|ed)$"),c=new RegExp("^(.*[aeiouy])(ing|ed)$"),h=/^(.*)(at|bl|iz)$/,d=new RegExp("^(.*)([a-z])\\2$"),f=new RegExp("^(.*)c(i|e|y)$"),p=new RegExp("^(.*)s$"),g=/s$/,y=/ies$/,m=/sses$/,v=/ied$/,x=/eed$/,w=new RegExp("^(.*[aeiouy].*)eed$"),S=new RegExp("^(.*[^aeiouy])(y)$"),E=/ll$/,b=/[^aeiouy]$/,L=new RegExp("^("+r+")?"+r+"(.[^aeiouy])?$"),k=new RegExp("^"+r+r),O=new RegExp("^("+r+")?"+r),Q=new RegExp("^("+r+")?"+r+r+"(.[^aeiouy])?$"),N=new RegExp("^("+r+")?"+r+"(.[^aeiouy])");return function(r){var A,P,R,I,j,U,F;if(r.str.length<3)return r;if(R=r.str,i.test(R))R=R.slice(0,1);else if(o.test(R)){var M=o.exec(R);R=M[1]}if(s.test(R))R=R.slice(0,-1)+"i";if(A=y,P=m,A.test(R))R=R.slice(0,-2);else if(P.test(R))R=R.slice(0,-2);else if(g.test(R))R=R.slice(0,-1);if(A=v,P=w,I=x,A.test(R)){var D=A.exec(R);if(U=D[1],O.test(U))R=U+"i"}else if(P.test(R)){var q=P.exec(R);if(U=q[1],k.test(U))R=U+"ee"}else if(I.test(R)){var B=I.exec(R);if(U=B[1],k.test(U))R=U}if(A=l,P=c,a.test(R)&&(A=P),A.test(R)){var H=A.exec(R);U=H[1],O.test(U)&&(R=U,h.test(R)?R+="e":d.test(R)?(R=R.slice(0,-1),b.test(R)||E.test(R)||(R+="e")):f.test(R)&&(R=R.slice(0,-1)+"k"))}if(A=S,S.test(R)){var z=A.exec(R);U=z[1],F=z[2],R=U+"i"}if(j=Object.keys(e),M=j.filter(function(e){return R.endsWith(e)}).sort(function(e,t){return t.length-e.length})[0],void 0!==M){var W=R.lastIndexOf(M);U=R.slice(0,W),O.test(U)&&(R=U+e[M])}if(j=Object.keys(t),M=j.filter(function(e){return R.endsWith(e)}).sort(function(e,t){return t.length-e.length})[0],void 0!==M){var K=R.lastIndexOf(M);U=R.slice(0,K),k.test(U)&&(R=U+t[M])}if(p.test(R)&&!/s(s|is|us|ss)$/.test(R))R=R.slice(0,R.length-1);return A=/e$/,Q.test(R)?R=R.slice(0,-1):N.test(R)||L.test(R)||!/..[^aeiouy]$/.test(R)||/w$|x$|y$/.test(R)||(R=R.slice(0,-1)),E.test(R)&&k.test(R)&&(R=R.slice(0,-1)),r.str=R,r}}(),Builder:function(){this.b=this._b,this.k1=this._k1,this.ref=this._ref,this.fields=this._fields,this.tokenizer=this.tokenizer,this.pipeline=this.pipeline,this.searchPipeline=this.searchPipeline,this.documentCount=this.documentCount,this.termIndex=this.termIndex,this.metadataWhitelist=this.metadataWhitelist,this.invertedIndex=new this.InvertedIndex,this.fieldStore=new this.FieldStore,this.tokenSet=this.TokenSet.empty,this.documentStore=new this.DocumentStore,this.fieldVectors={},this.fieldLengths={},this.add=function(e,t){var r=e[this.ref],n=Object.keys(this.fields);this.documentStore.add(e,t),this.documentCount+=1;for(var i=0;i<n.length;i++){var o=n[i],s=this.fields[o],a=s.extractor;if(a){var l=a(e);if(void 0!==l&&null!==l&&""!==l){var u=this.tokenizer(l,{fields:o}),c=this.pipeline.run(u),h=new this.Vector,d={};c.forEach(function(e,t,r){var n=h.insert(this.termIndex,e.metadata.position.length),i=e.str;d[i]||(d[i]=[]),d[i].push(t);var o=this.tokenSet.insert(e);if(o)this.termIndex+=1},this),this.fieldStore.add(o,r,c,d,n)}}}},this.build=function(){var e=this.fieldStore.calculateFieldVectors(this.Vector);this.fieldVectors=e.fieldVectors,this.fieldLengths=e.fieldLengths,this.documentStore.docs;Object.keys(this.documentStore.docs).forEach(function(e){this.fieldStore.store(e,this.fieldLengths)}.bind(this));var t={};return Object.keys(this.fieldVectors).forEach(function(e){var r=this.fieldVectors[e].elements.map(function(e){return[e[0],Math.round(1e3*e[1]/this.fieldVectors[e].magnitude*100)/100]});t[e]=r.slice(0,50)},this),Object.freeze(t),new this.Index({invertedIndex:this.invertedIndex,fieldStore:this.fieldStore,tokenSet:this.tokenSet,fieldVectors:t,documentStore:this.documentStore,pipeline:this.pipeline})},this.use=function(e,t){var r=Array.prototype.slice.call(arguments,1);r.unshift(this),e.apply(this,r)},this.idf=function(e,t){var r=0;return this.fieldStore.intersect(e,t,function(e,t,r){r.df&&(r.df>0?r=r.df:r=1,r+=1,r=1+Math.log(this.documentStore.length/r),r>0?r:r=1e-6)}),r}},Index:function(e){this.invertedIndex=e.invertedIndex,this.fieldStore=e.fieldStore,this.tokenSet=e.tokenSet,this.fieldVectors=e.fieldVectors,this.documentStore=e.documentStore,this.pipeline=e.pipeline,this.searchPipeline=e.searchPipeline||e.pipeline,this.b=this._b,this.k1=this._k1},idf:function(e,t){var r=0;return this.fieldStore.intersect(e,t,function(e,t,r){r.df&&(r.df>0?r=r.df:r=1,r+=1,r=1+Math.log(this.documentStore.length/r),r>0?r:r=1e-6)}),r},search:function(e){var t=this.tokenizer(e),r=this.searchPipeline.run(t),n=new this.Query(r),i=this.query(n),o={};return i.forEach(function(e){var t=this.documentStore.get(e.ref);o[e.ref]={ref:e.ref,score:e.score,matchData:e.matchData,doc:t}},this),Object.values(o)},query:function(e){var t=new this.Query(e.clauses),r=this.search(t);return r.map(function(e){return{ref:e.ref,score:e.score,matchData:new this.MatchData(e.matchData)}}.bind(this))},tokenizer:c=function(e,t){if(null==e||void 0==e)return[];if(Array.isArray(e))return e.map(function(e){return new this.Token(e.toLowerCase(),t)});for(var r=e.toString().toLowerCase(),n=r.length,i=0,o=[],s=0,a=0;i<=n;i++){var l=r.charAt(i),u=i-s;if(l.match(this.tokenizer.separator)||i==n){if(u>0){var c=new this.Token(r.slice(s,i),t);c.metadata.position=[s,u],c.metadata.index=a++,o.push(c)}s=i+1}}return o}},Pipeline:h=function(){function e(e){return new h(e)}this.add=function(){var e=Array.prototype.slice.call(arguments);e.forEach(function(e){this.registerFunction(e),this._stack.push(e)},this)},this.after=function(e,t){this.registerFunction(t);var r=this._stack.indexOf(e);if(r==-1)throw new Error("Cannot find existingFn");r+=1,this._stack.splice(r,0,t)},this.before=function(e,t){this.registerFunction(t);var r=this.stack.indexOf(e);if(r==-1)throw new Error("Cannot find existingFn");this._stack.splice(r,0,t)},this.remove=function(e){var t=this._stack.indexOf(e);t!==-1&&this._stack.splice(t,1)},this.run=function(e){for(var t=[],r=e.length,n=this._stack.length,i=0;i<r;i++){for(var o=e[i],s=0;s<n&&(o=this._stack[s](o,i,e),void 0!==o&&""!==o);s++);void 0!==o&&""!==o&&t.push(o)}return t},this.runString=function(e,t){var r=new this.tokenizer(e,t);return this.run(r)},this.reset=function(){this._stack=[]},this.toJSON=function(){return this._stack.map(function(t){return e.Pipeline.registeredFunctions[t.label]})},this.registerFunction=function(t,r){if("function"!=typeof t)throw new Error("Check your maps, you provided a function that is not actually a function");t.label&&e.Pipeline.registeredFunctions[t.label]||(t.label=r||this.serialiseCounter++,e.Pipeline.registeredFunctions[t.label]=t)}},Vector:d=function(){function e(e){return new d(e)}this.add=function(t){return this.insert(t[0],t[1]),this},this.reduce=function(e,t){if(0==this.length)return t;var r=this.elements.slice().sort(function(e,t){return e[0]-t[0]});t=e(t,r[0],0,r);for(var n=1;n<r.length;n++)t=e(t,r[n],n,r);return t},this.forEach=function(e,t){if(0!=this.length){t=t||this;for(var r=0;r<this.length;r++){var n=this.elements[r];e.call(t,n[1],n[0],n)}}}},TokenSet:f=function(){function e(e){return new f(e)}this.add=function(t){var r=!0;return t.forEach(function(t){r=this.insert(t)&&r},this),r},this.toArray=function(){return this.root.toArray().map(function(e){return this.edges[e].str})},this.toString=function(){return this.toArray().join(",")},this.intersect=function(t){var r=new e,n=Object.keys(this.edges).sort(),i=Object.keys(t.edges).sort(),o=n.length,s=i.length,a=0,l=0;for(;(a<o)&&(l<s);){var u=n[a],c=i[l],h=this.edges[u].str,d=t.edges[c].str;h<d?a++:h>d?l++:(h==d&&r.add(d),a++,l++)}return r}},Token:function(e,t){this.str=e||"",this.metadata=t||{},this.string="["+this.str+"]",Object.freeze(this)},Query:function(e){this.clauses=e.slice()},QueryLexer:p=function(){function e(e){return"number"==typeof e?e:e.charCodeAt(0)-96}this.lex=function(t){var r=new e.QueryLexer(t),n=[],i=e.QueryLexer.STATES.FIELD;return r.run(function(e,t,o){n.push({type:e,str:t,start:o,end:r.pos})}),n}},QueryParser:g=function(){function e(e){return new g.QueryParser(e)}this.parse=function(t){"string"==typeof t&&(t=this.lexer.lex(t));var r=this.clauses,n=this.currentClause,i=[];return t.forEach(function(t,o,s){var a=t.type;switch(a){case e.QueryLexer.TYPES.FIELD:i.push(t.str);break;case e.QueryLexer.TYPES.TERM:this.parseTerm(t,i);break;case e.QueryLexer.TYPES.PRESENCE:this.parsePresence(t,i);break;case e.QueryLexer.TYPES.BOOST:this.parseBoost(t,i);break;case e.QueryLexer.TYPES.EDIT_DISTANCE:this.parseEditDistance(t,i);break;case e.QueryLexer.TYPES.EOS:this.parseTerm(t,i);break;default:throw new Error("Unexpected lexer type: "+a)}i=[]}.bind(this)),r.length>1&&r.slice(1).forEach(function(e){e.presence==e.constructor.PRESENCE.PROHIBITED&&(e.presence=e.constructor.PRESENCE.REQUIRED)}),new e.Query(r)},this.parseTerm=function(t,r){var i=this.currentClause,s=t.str.toLowerCase();if(""!==s){i.term=s;var a={};a[s]={};var l=new e.MatchData(s,a);i.matchData=l,t.str.indexOf("*")!==-1&&(i.wildcard=e.Query.WILDCARD.TRAILING);var u=t.str.length-1;t.str.charAt(u)=="*"?u>0&&t.str.charAt(u-1)=="*"?(i.wildcard=e.Query.WILDCARD.LEADING|e.Query.WILDCARD.TRAILING,i.term=t.str.slice(1,u)):(i.wildcard=e.Query.WILDCARD.TRAILING,i.term=t.str.slice(0,u)):t.str.charAt(0)=="*"&&(i.wildcard=e.Query.WILDCARD.LEADING,i.term=t.str.slice(1)),r.length&&(i.fields=r),this.clauses.push(i),this.currentClause=new e.Query.Clause}},this.parsePresence=function(t,r){var n=t.str;switch(n){case"-":this.currentClause.presence=e.Query.Clause.PRESENCE.PROHIBITED;break;case"+":this.currentClause.presence=e.Query.Clause.PRESENCE.REQUIRED;break;default:throw new Error("Unexpected presence operator '"+n+"'")}r.length&&(this.currentClause.fields=r)},this.parseBoost=function(t,r){var n=parseInt(t.str,10);if(isNaN(n))throw new Error("Invalid boost '"+t.str+"'");this.currentClause.boost=n,r.length&&(this.currentClause.fields=r)},this.parseEditDistance=function(t,r){var n=parseInt(t.str,10);if(isNaN(n))throw new Error("Invalid edit distance '"+t.str+"'");this.currentClause.editDistance=n,r.length&&(this.currentClause.fields=r)}},MatchData:function(e,t,r){this.metadata=r||{},this.metadata[e]=Object.keys(t).reduce(function(e,r){return e[r]=t[r].slice(),e},{}),Object.freeze(this.metadata),Object.defineProperty(this,"terms",{value:Object.keys(this.metadata)}),Object.defineProperty(this,"queryTerms",{value:this.terms.filter(function(e){return Object.keys(this.metadata[e]).some(function(e){return this.metadata[e].position}.bind(this))}.bind(this))})}},e.Builder.prototype=Object.create(null),e.Builder.prototype.constructor=e.Builder,e.Builder.prototype._b=.75,e.Builder.prototype._k1=1.2,e.Builder.prototype._ref="id",e.Builder.prototype._fields={},e.Builder.prototype.tokenizer=U,e.Builder.prototype.pipeline=new Yt,e.Builder.prototype.searchPipeline=new Yt,e.Builder.prototype.documentCount=0,e.Builder.prototype.termIndex=0,e.Builder.prototype.metadataWhitelist=[],e.Builder.prototype.field=function(e,t){if(null==e)throw new Error("field name cannot be null");if(void 0===t)t={};else if("function"==typeof t)t={extractor:t};else{if(null==t)throw new Error("field options cannot be null");"string"==typeof t.extractor&&(t.extractor=function(e){return e[t.extractor]})}return this._fields[e]=t,this},e.Builder.prototype.b=function(e){e<0?this.b=0:e>1?this.b=1:this.b=e},e.Builder.prototype.k1=function(e){this.k1=e},e.Builder.prototype.ref=function(e){this.ref=e},e.Builder.prototype.add=function(t,r){if(null==t||void 0==t)return;var n=t[this.ref];if(null==n||void 0==n)throw new Error("Document does not have a '"+this.ref+"' field");this.documentStore.add(n,r),this.documentCount+=1;var i=Object.keys(this._fields);for(var o=0;o<i.length;o++){var s=i[o],a=this._fields[s],l=a.extractor;if(l){var u=l(t);if(void 0!==u&&null!==u&&""!==u){var c=this.tokenizer(u,{fields:s}),h=this.pipeline.run(c),d=new e.Vector,f={};h.forEach(function(e,t,r){var n=d.insert(this.termIndex,e.metadata.position.length),i=e.str;f[i]||(f[i]=[]),f[i].push(t);var o=this.tokenSet.insert(e);if(o)this.termIndex+=1},this),this.fieldStore.add(s,n,h,f,n)}}}},e.Builder.prototype.build=function(){var t=this.fieldStore.calculateFieldVectors(e.Vector);this.fieldVectors=t.fieldVectors,this.fieldLengths=t.fieldLengths,this.documentStore.docs;Object.keys(this.documentStore.docs).forEach(function(e){this.fieldStore.store(e,this.fieldLengths)}.bind(this));var r={};return Object.keys(this.fieldVectors).forEach(function(e){var t=this.fieldVectors[e].elements.map(function(e){return[e[0],Math.round(1e3*e[1]/this.fieldVectors[e].magnitude*100)/100]});r[e]=t.slice(0,50)},this),Object.freeze(r),new e.Index({invertedIndex:this.invertedIndex,fieldStore:this.fieldStore,tokenSet:this.tokenSet,fieldVectors:r,documentStore:this.documentStore,pipeline:this.pipeline})},e.Builder.prototype.use=function(e,t){var r=Array.prototype.slice.call(arguments,1);r.unshift(this),e.apply(this,r)},e.Builder.prototype.idf=function(e,t){var r=0;return this.fieldStore.intersect(e,t,function(e,t,r){r.df&&(r.df>0?r=r.df:r=1,r+=1,r=1+Math.log(this.documentStore.length/r),r>0?r:r=1e-6)}),r},e.FieldRef.prototype=Object.create(null),e.FieldRef.prototype.constructor=e.FieldRef,e.FieldRef.join=function(e){return e.join("/")},e.MatchData.prototype=Object.create(null),e.MatchData.prototype.constructor=e.MatchData,e.MatchData.prototype.combine=function(t){Object.keys(t.metadata).forEach(function(r){Object.keys(t.metadata[r]).forEach(function(n){Object.keys(t.metadata[r][n]).forEach(function(i){t.metadata[r][n][i].forEach(function(t){this.metadata[r][n][i]=this.metadata[r][n][i].concat(t)},this)},this)},this)},this)},e.Query.prototype=Object.create(null),e.Query.prototype.constructor=e.Query,e.Query.Clause=function(t){var r=Object.assign({boost:1,fields:e.Query.wildcard,wildcard:e.Query.WILDCARD.NONE,presence:e.Query.Clause.PRESENCE.OPTIONAL},t);Object.assign(this,r)},e.Query.Clause.prototype=Object.create(null),e.Query.Clause.prototype.constructor=e.Query.Clause,e.Query.Clause.PRESENCE={OPTIONAL:1,REQUIRED:2,PROHIBITED:3},e.Query.WILDCARD={NONE:0,LEADING:1,TRAILING:2},e.QueryLexer.prototype=Object.create(null),e.QueryLexer.prototype.constructor=e.QueryLexer,e.QueryLexer.STATES={FIELD:1,TERM:2,EDIT_DISTANCE:3,BOOST:4,PRESENCE:5},e.QueryLexer.TYPES={FIELD:1,TERM:2,EDIT_DISTANCE:3,BOOST:4,PRESENCE:5,EOS:6},e.QueryLexer.tokenise=function(t){var r=new e.QueryLexer(t),n=[],i=e.QueryLexer.STATES.FIELD;return r.run(function(e,t,o){n.push({type:e,str:t,start:o,end:r.pos})}),n},e.QueryLexer.prototype.pos=0,e.QueryLexer.prototype.str=null,e.QueryLexer.prototype.run=function(t){for(var r=e.QueryLexer.STATES.FIELD;r;)r=this[r](t)},e.QueryLexer.prototype.sliceString=function(e,t){var r=this.str.slice(e,t);return{str:r,length:r.length}},e.QueryLexer.prototype.FIELD=function(t){var r=this.pos,n=this.str,i=n.length,o="",s=r;for(var a=s;a<i;a++){var l=n.charAt(a);switch(l){case":":o=n.slice(r,a),this.pos=a+1,t(e.QueryLexer.TYPES.FIELD,o,r,a);return e.QueryLexer.STATES.TERM;case"\\":var u=a+1;u<i&&(o+=n.charAt(u),a=u);break;default:if(l.match(/[a-zA-Z0-9]/))o+=l;else{var c=this.sliceString(r,a);this.pos=a,t(e.QueryLexer.TYPES.TERM,c.str,r,a);return e.QueryLexer.STATES.TERM}}}var h=this.sliceString(r,i);return this.pos=i,t(e.QueryLexer.TYPES.TERM,h.str,r,i),null},e.QueryLexer.prototype.TERM=function(t){var r=this.pos,n=this.str,i=n.length,o="",s=r,a=e.QueryLexer.STATES.TERM;for(var l=s;l<i;l++){var u=n.charAt(l);switch(u){case"~":this.pos=l+1,o=n.slice(r,l),o.length>0&&t(e.QueryLexer.TYPES.TERM,o,r,l);return e.QueryLexer.STATES.EDIT_DISTANCE;case"^":this.pos=l+1,o=n.slice(r,l),o.length>0&&t(e.QueryLexer.TYPES.TERM,o,r,l);return e.QueryLexer.STATES.BOOST;case"+":this.pos=l+1,o=n.slice(r,l),o.length>0&&t(e.QueryLexer.TYPES.TERM,o,r,l),t(e.QueryLexer.TYPES.PRESENCE,u,l,this.pos);return e.QueryLexer.STATES.FIELD;case"-":this.pos=l+1,o=n.slice(r,l),o.length>0&&t(e.QueryLexer.TYPES.TERM,o,r,l),t(e.QueryLexer.TYPES.PRESENCE,u,l,this.pos);return e.QueryLexer.STATES.FIELD;case":":o=n.slice(r,l),this.pos=l+1,o.length>0?t(e.QueryLexer.TYPES.FIELD,o,r,l):t(e.QueryLexer.TYPES.FIELD,"",r,l);return e.QueryLexer.STATES.TERM;case"\\":var c=l+1;c<i&&(o+=n.charAt(c),l=c);break;default:if(u.match(/\s/)){this.pos=l,o=n.slice(r,l),o.length>0&&t(e.QueryLexer.TYPES.TERM,o,r,l);return e.QueryLexer.STATES.FIELD}o+=u}}return o=n.slice(r,i),this.pos=i,o.length>0&&t(e.QueryLexer.TYPES.TERM,o,r,i),t(e.QueryLexer.TYPES.EOS,"",i,i),null},e.QueryLexer.prototype.EDIT_DISTANCE=function(t){var r=this.pos,n=this.str,i=n.length,o="",s=r;for(var a=s;a<i;a++){var l=n.charAt(a);if(l.match(/[0-9]/))o+=l;else{this.pos=a;var u=1;return isNaN(parseInt(o,10))||(u=parseInt(o,10)),t(e.QueryLexer.TYPES.EDIT_DISTANCE,u,r,a),e.QueryLexer.STATES.TERM}}var c=1;return isNaN(parseInt(o,10))||(c=parseInt(o,10)),this.pos=i,t(e.QueryLexer.TYPES.EDIT_DISTANCE,c,r,i),null},e.QueryLexer.prototype.BOOST=function(t){var r=this.pos,n=this.str,i=n.length,o="",s=r;for(var a=s;a<i;a++){var l=n.charAt(a);if(l.match(/[0-9]/))o+=l;else{this.pos=a;var u=1;return isNaN(parseInt(o,10))||(u=parseInt(o,10)),t(e.QueryLexer.TYPES.BOOST,u,r,a),e.QueryLexer.STATES.TERM}}var c=1;return isNaN(parseInt(o,10))||(c=parseInt(o,10)),this.pos=i,t(e.QueryLexer.TYPES.BOOST,c,r,i),null},e.QueryLexer.prototype.PRESENCE=function(t){var r=this.pos,n=this.str,i=n.length,o=r,s=n.charAt(r);switch(s){case"-":this.pos=r+1,t(e.QueryLexer.TYPES.PRESENCE,"-",r,this.pos);return e.QueryLexer.STATES.FIELD;case"+":this.pos=r+1,t(e.QueryLexer.TYPES.PRESENCE,"+",r,this.pos);return e.QueryLexer.STATES.FIELD;default:throw new Error("Unexpected character '"+s+"' at index "+r)}return null},e.QueryParser.prototype=Object.create(null),e.QueryParser.prototype.constructor=e.QueryParser,e.QueryParser.prototype.parse=function(t){"string"==typeof t&&(t=this.lexer.lex(t));var r=this.clauses,n=this.currentClause,i=[];return t.forEach(function(t,o,s){var a=t.type;switch(a){case e.QueryLexer.TYPES.FIELD:i.push(t.str);break;case e.QueryLexer.TYPES.TERM:this.parseTerm(t,i);break;case e.QueryLexer.TYPES.PRESENCE:this.parsePresence(t,i);break;case e.QueryLexer.TYPES.BOOST:this.parseBoost(t,i);break;case e.QueryLexer.TYPES.EDIT_DISTANCE:this.parseEditDistance(t,i);break;case e.QueryLexer.TYPES.EOS:this.parseTerm(t,i);break;default:throw new Error("Unexpected lexer type: "+a)}i=[]}.bind(this)),r.length>1&&r.slice(1).forEach(function(e){e.presence==e.constructor.PRESENCE.PROHIBITED&&(e.presence=e.constructor.PRESENCE.REQUIRED)}),new e.Query(r)},e.QueryParser.prototype.parseTerm=function(t,r){var n=this.currentClause,i=t.str.toLowerCase();if(""!==i){n.term=i;var o={};o[i]={};var s=new e.MatchData(i,o);n.matchData=s,t.str.indexOf("*")!==-1&&(n.wildcard=e.Query.WILDCARD.TRAILING);var a=t.str.length-1;t.str.charAt(a)=="*"?a>0&&t.str.charAt(a-1)=="*"?(n.wildcard=e.Query.WILDCARD.LEADING|e.Query.WILDCARD.TRAILING,n.term=t.str.slice(1,a)):(n.wildcard=e.Query.WILDCARD.TRAILING,n.term=t.str.slice(0,a)):t.str.charAt(0)=="*"&&(n.wildcard=e.Query.WILDCARD.LEADING,n.term=t.str.slice(1)),r.length&&(n.fields=r),this.clauses.push(n),this.currentClause=new e.Query.Clause}},e.QueryParser.prototype.parsePresence=function(t,r){var n=t.str;switch(n){case"-":this.currentClause.presence=e.Query.Clause.PRESENCE.PROHIBITED;break;case"+":this.currentClause.presence=e.Query.Clause.PRESENCE.REQUIRED;break;default:throw new Error("Unexpected presence operator '"+n+"'")}r.length&&(this.currentClause.fields=r)},e.QueryParser.prototype.parseBoost=function(t,r){var n=parseInt(t.str,10);if(isNaN(n))throw new Error("Invalid boost '"+t.str+"'");this.currentClause.boost=n,r.length&&(this.currentClause.fields=r)},e.QueryParser.prototype.parseEditDistance=function(t,r){var n=parseInt(t.str,10);if(isNaN(n))throw new Error("Invalid edit distance '"+t.str+"'");this.currentClause.editDistance=n,r.length&&(this.currentClause.fields=r)},e.QueryParser.prototype.lexer=new e.QueryLexer,e.QueryParser.prototype.clauses=[],e.QueryParser.prototype.currentClause=new e.Query.Clause,e.Index.prototype=Object.create(null),e.Index.prototype.constructor=e.Index,e.Index.prototype._b=.75,e.Index.prototype._k1=1.2,e.Index.prototype.search=function(t){return this.query(function(r){var n=new e.QueryParser(r);n.parse(t)}.bind(this))},e.Index.prototype.query=function(t){var r=new e.Query(this.fields),n=Object.create(null),i=Object.create(null),o=Object.create(null),s=Object.create(null),a=Object.create(null);return t.call(r,r),r.clauses.forEach(function(t,r){var a=this.resolveClause(t);a.size>0&&(i[r]=a)}.bind(this)),r.clauses.forEach(function(t,r){var l=i[r];if(l){t.presence==e.Query.Clause.PRESENCE.REQUIRED&&this.applyPresence(n,l,r),t.presence==e.Query.Clause.PRESENCE.PROHIBITED&&this.applyProhibition(o,l,r);var u=t.boost;l.forEach(function(e,t,i){var a=this.documentStore.get(t);this.fieldStore.intersect(e,t,function(e,t,r){var l=this.idf(e,r),c=1;Object.keys(this.fieldStore.get(t)).forEach(function(n){Object.keys(this.fieldStore.get(t)[n]).forEach(function(t){this.fieldStore.get(t)[n][t].position&&this.fieldStore.get(t)[n][t].position.forEach(function(i){var o=this.fieldVectors[n].get(i);if(o){var a=this.fieldStore.get(t)[n][t].position.length/o;c=Math.min(c,a)}}.bind(this))}.bind(this))}.bind(this));var d=this.fieldStore.getTermFrequency(e,t,r);if(1==u||void 0===u)u=1;var f=this.fieldStore.get(t).magnitude/this.documentStore.get(t).magnitude;if(void 0===s[t]){s[t]=0,n[t]=1}s[t]+=(u*l*d*(this._k1+1))/(d+this._k1*(1-this._b+this._b*f))*c}.bind(this))}.bind(this))}.bind(this)),this.coordinate(n,s),Object.keys(n).filter(function(e){return!(e in o)}.bind(this)).map(function(e){return{ref:e,score:s[e],matchData:a[e]}}.bind(this)).sort(function(e,t){return t.score-e.score})},e.Index.prototype.resolveClause=function(t){var r,n,i=new e.Vector,o=!0;t.wildcard&(o=!1);var s=t.term;return o||(s=this.tokenSet.toArray().filter(function(e){return this.tokenSet.edges[e].str.indexOf(t.term)!==-1},this)),s.forEach(function(o){var s=this.tokenSet.fromString(o),a=!1;if(s==e.Token.WILDCARD)return;o.indexOf("*")!==-1&&(a=!0);var l=this.invertedIndex.get(s);l&&(t.fields?t.fields.forEach(function(e,t,r){var n=l[e];n&&i.add(n)}.bind(this)):i.add(l.docs),i.forEach(function(e,t,r){i.add(r)}.bind(this)))}.bind(this)),r=i,n=t.editDistance,r.reduce(function(t,r,i){var o=r-i[0],s=i[1],a=Math.ceil(s/o),l=Math.floor(s/o);a>n&&(t=t.add([l,s])),t=t.add(i);for(var u=o-1;u>=1;u--){var c=Math.ceil((s-u)/o),h=Math.floor((s+u)/o);c>n||(t=t.add([c,s]),t=t.add([h,s]))}return t},new e.Vector)},e.Index.prototype.applyPresence=function(e,t,r){t.forEach(function(t,i,o){e[i]=(e[i]||0)+1}.bind(this))},e.Index.prototype.applyProhibition=function(e,t,r){t.forEach(function(t,i,o){e[i]=1}.bind(this))},e.Index.prototype.coordinate=function(e,t){var r=Object.keys(e).length;Object.keys(t).forEach(function(n){t[n]=t[n]*e[n]/r}.bind(this))},e.Index.prototype.idf=function(e,t){var r=0;return this.fieldStore.intersect(e,t,function(e,t,r){r.df&&(r.df>0?r=r.df:r=1,r+=1,r=1+Math.log(this.documentStore.length/r),r>0?r:r=1e-6)}),r},e.Index.prototype.load=function(t){var r=t.version,n=t.fields,i=t.fieldVectors,o=t.tokenSet,s=t.invertedIndex,a=t.pipeline;this.b=t.b,this.k1=t.k1,this.fields=n,this.tokenSet=e.TokenSet.load(o),this.invertedIndex=e.InvertedIndex.load(s),this.documentStore=e.DocumentStore.load(t.documentStore),this.pipeline=e.Pipeline.load(a),this.searchPipeline=e.Pipeline.load(t.searchPipeline||a),this.fieldVectors=Object.keys(i).reduce(function(t,r){return t[r]=new e.Vector(i[r]),t},{}),this.fieldStore=e.FieldStore.load(t.fieldStore)},e.Index.prototype.toJSON=function(){return{version:e.version,fields:this.fields,fieldVectors:this.fieldVectors,tokenSet:this.tokenSet.toJSON(),invertedIndex:this.invertedIndex.toJSON(),documentStore:this.documentStore.toJSON(),fieldStore:this.fieldStore.toJSON(),pipeline:this.pipeline.toJSON(),searchPipeline:this.searchPipeline.toJSON(),b:this.b,k1:this.k1}},e.Token.prototype=Object.create(null),e.Token.prototype.constructor=e.Token,e.Token.prototype.toString=function(){return this.str},e.Token.prototype.update=function(e){return this.str=e(this.str,this.metadata),this},e.Token.prototype.clone=function(e){return e=e||function(e){return e},new e.Token(e(this.str,this.metadata),this.metadata)},e.TokenSet.prototype=Object.create(null),e.TokenSet.prototype.constructor=e.TokenSet,e.TokenSet.prototype.insert=function(e){var t,r=this.root,n=0;e.str;for(var i=0;i<e.str.length;i++){var o=e.str[i];r[o]||(r[o]={}),r=r[o]}return r.final||(r.final=!0,n=this.nextId,this.nextId+=1,this.edges[n]={str:e.str,node:r}),r.id=n,r.final},e.TokenSet.prototype.toArray=function(){var e=[];for(var t in this.edges)e.push(this.edges[t].str);return e},e.TokenSet.prototype.toString=function(){return this.toArray().join(",")},e.TokenSet.prototype.intersect=function(t){var r=new e,n=Object.keys(this.edges).sort(),i=Object.keys(t.edges).sort(),o=n.length,s=i.length,a=0,l=0;for(;(a<o)&&(l<s);){var u=n[a],c=i[l],h=this.edges[u].str,d=t.edges[c].str;h<d?a++:h>d?l++:(h==d&&r.add(d),a++,l++)}return r},e.TokenSet.load=function(t){var r=new this;return r.edges=t.edges,r.root=t.root,r.nextId=t.nextId,r},e.TokenSet.prototype.toJSON=function(){return{edges:this.edges,root:this.root,nextId:this.nextId}},e.TokenSet.empty=new e.TokenSet,e.TokenSet.Builder=function(){this.previous=null,this.root={},this.nextId=0,this.edges={},this.build=function(){var t=new e.TokenSet;return t.edges=this.edges,t.root=this.root,t.nextId=this.nextId,t}},e.Vector.prototype=Object.create(null),e.Vector.prototype.constructor=e.Vector,e.Vector.prototype.elements=[],e.Vector.prototype.length=0,e.Vector.prototype.insert=function(e,t){if(0==this.length)return this.elements.push([e,t]),void(this.length=1);var r=this.elements.length-1,n=this.elements[r];n[0]<e?this.elements.push([e,t]):n[0]>e?this_s.elements.unshift([e,t]):n[1]=t,this.length=this.elements.length},e.Vector.prototype.magnitude=function(){if(this._magnitude)return this._magnitude;if(0==this.length)return this._magnitude=0;for(var e=0,t=this.length,r=0;r<t;r++){var n=this.elements[r][1];e+=n*n}return this._magnitude=Math.sqrt(e)},e.Vector.prototype.add=function(t){return this.insert(t[0],t[1]),this},e.Vector.prototype.reduce=function(e,t){if(0==this.length)return t;var r=this.elements.slice().sort(function(e,t){return e[0]-t[0]});t=e(t,r[0],0,r);for(var n=1;n<r.length;n++)t=e(t,r[n],n,r);return t},e.Vector.prototype.forEach=function(e,t){if(0!=this.length){t=t||this;for(var r=0;r<this.length;r++){var n=this.elements[r];e.call(t,n[1],n[0],n)}}},e.Vector.prototype.similarity=function(e){if(0==this.length||0==e.length)return 0;for(var t=0,r=0,n=0,i=this.length,o=e.length,s=this.elements,a=e.elements,l=1/0,u=1/0,c=0;t<i&&r<o;)l=s[t][0],u=a[r][0],l<u?t++:l>u?r++:(c+=s[t][1]*a[r][1],t++,r++);return c/(this.magnitude()*e.magnitude())},e.Vector.prototype.toArray=function(){return this.elements.slice()},e.Vector.prototype.toJSON=function(){return this.elements},e.Vector.load=function(t){return new e.Vector(t)},e.DocumentStore.prototype=Object.create(null),e.DocumentStore.prototype.constructor=e.DocumentStore,e.DocumentStore.prototype.add=function(e,t){this.docs[e.ref]||this.length++,this.docs[e.ref]=e,this.docInfo[e.ref]=t},e.DocumentStore.prototype.get=function(e){return this.docs[e]},e.DocumentStore.prototype.has=function(e){return e in this.docs},e.DocumentStore.prototype.remove=function(e){this.has(e)&&(delete this.docs[e],delete this.docInfo[e],this.length--)},e.DocumentStore.prototype.getDocInfo=function(e){return this.docInfo[e]},e.DocumentStore.prototype.getDocInfos=function(){return this.docInfo},e.DocumentStore.prototype.toJSON=function(){return{docs:this.docs,docInfo:this.docInfo,length:this.length}},e.DocumentStore.load=function(t){var r=new this;return r.docs=t.docs,r.docInfo=t.docInfo,r.length=t.length,r},e.FieldStore.prototype=Object.create(null),e.FieldStore.prototype.constructor=e.FieldStore,e.FieldStore.prototype.add=function(e,t,r,n,i){this.fields[e]||(this.fields[e]=Object.create(null)),this.fields[e][t]||(this.fields[e][t]=Object.create(null)),this.fields[e][t][r]||(this.fields[e][t][r]=Object.create(null));var o=0;n.forEach(function(e,t,r){o+=e},this),this.fields[e][t][r].length=i,this.fields[e][t][r].position=n.map(function(e,t,r){return[e,r[t+1]-r[t-1]||1]}).slice(0,n.length/2)},e.FieldStore.prototype.get=function(e){return this.fields[e]},e.FieldStore.prototype.has=function(e,t,r){return!!this.fields[e]&&!!this.fields[e][t]&&!!this.fields[e][t][r]},e.FieldStore.prototype.getTermFrequency=function(e,t,r){return this.fields[e]&&this.fields[e][t]&&this.fields[e][t][r]?this.fields[e][t][r].length:0},e.FieldStore.prototype.getTermPositions=function(e,t,r){return this.fields[e]&&this.fields[e][t]&&this.fields[e][t][r]?this.fields[e][t][r].position.slice():[]},e.FieldStore.prototype.intersect=function(e,t,r,n){n=n||Object.create(null),this.fields[e]&&Object.keys(this.fields[e]).forEach(function(i){this.fields[e][i][t]&&r(i,t,e)},this)},e.FieldStore.prototype.store=function(e,t,r){if(!this.fields[t]||!this.fields[t][r])return null;var n=this.fields[t][r];return n?{magnitude:Math.sqrt(Object.keys(n).reduce(function(e,t){return e+n[t].length*n[t].length},0)),docRef:r}:null},e.FieldStore.prototype.calculateFieldVectors=function(e){var t={},r=this.fields;Object.keys(r).forEach(function(n){var i=r[n];Object.keys(i).forEach(function(r){var n=i[r];Object.keys(n).forEach(function(i){t[i]||(t[i]=new e),t[i].insert(this.termIndex,n[i].length)}.bind(this)),this.termIndex++}.bind(this))}.bind(this));var n=Object.create(null);return Object.keys(t).forEach(function(e){n[e]=t[e].magnitude},this),{fieldVectors:t,fieldLengths:n}},e.FieldStore.prototype.remove=function(e){Object.keys(this.fields).forEach(function(t){Object.keys(this.fields[t]).forEach(function(r){delete this.fields[t][r][e]})}.bind(this))},e.FieldStore.prototype.toJSON=function(){return{fields:this.fields,termIndex:this.termIndex}},e.FieldStore.load=function(t){var r=new this;return r.fields=t.fields,r.termIndex=t.termIndex,r},e.InvertedIndex.prototype=Object.create(null),e.InvertedIndex.prototype.constructor=e.InvertedIndex,e.InvertedIndex.prototype.add=function(e,t){var r=this.root,n=0;e.forEach(function(e,i){var o=e.str;r[o]||(r[o]={docs:{},df:0});var s=0;Object.keys(t.fields).forEach(function(e){var r=t.fields[e];r.indexOf(i)!==-1&&(s=1)});for(var a=0;a<e.str.length;a++)r=r[e.str[a]]||(r[e.str[a]]={docs:{},df:0});r.docs[t.ref]=s,n=1}.bind(this)),r.df+=n},e.InvertedIndex.prototype.get=function(e){var t=this.root,r=e.str;try{for(var n=0;n<r.length;n++)t=t[r[n]]}catch(e){return null}return t},e.InvertedIndex.prototype.has=function(e){var t=this.root,r=e.str;try{for(var n=0;n<r.length;n++)t=t[r[n]]}catch(e){return!1}return!0},e.InTries.prototype.remove=function(e,t){var r=this.root;e.forEach(function(e){var n=e.str;try{for(var i=0;i<n.length;i++)r=r[n[i]];var o=Object.keys(r.docs);delete r.docs[t],o.length-1==0&&(r.df=0)}catch(e){return}}.bind(this))},e.InvertedIndex.prototype.getNode=function(e){var t=this.root,r=e.str;try{for(var n=0;n<r.length;n++)t=t[r[n]];return t}catch(r){return e.metadata.wildcard||null}},e.InvertedIndex.prototype.expand=function(e,t){var r=this.getNode(e);return r?Object.keys(r.docs).length>0?[e]:t:Object.keys(r).filter(function(e){return"docs"!=e&&"df"!=e}).reduce(function(t,n){return t.concat(this.expand(new e.constructor(e.str+n,e.metadata),r[n]))}.bind(this),[])},e.InvertedIndex.prototype.toJSON=function(){return this.root},e.InvertedIndex.load=function(e){var t=new this;return t.root=e,t},e.Pipeline.prototype=Object.create(null),e.Pipeline.prototype.constructor=e.Pipeline,e.Pipeline.prototype._stack=[],e.Pipeline.prototype.serialiseCounter=0,e.Pipeline.registeredFunctions={},e.Pipeline.registerFunction=function(t,r){if("function"!=typeof t)throw new Error("Check your maps, you provided a function that is not actually a function");t.label=r,e.Pipeline.registeredFunctions[r]=t},e.Pipeline.prototype.add=function(){var e=Array.prototype.slice.call(arguments);e.forEach(function(e){this.registerFunction(e),this._stack.push(e)},this)},e.Pipeline.prototype.after=function(e,t){this.registerFunction(t);var r=this._stack.indexOf(e);if(r==-1)throw new Error("Cannot find existingFn");r+=1,this._stack.splice(r,0,t)},e.Pipeline.prototype.before=function(e,t){this.registerFunction(t);var r=this.stack.indexOf(e);if(r==-1)throw new Error("Cannot find existingFn");this._stack.splice(r,0,t)},e.Pipeline.prototype.remove=function(e){var t=this._stack.indexOf(e);t!==-1&&this._stack.splice(t,1)},e.Pipeline.prototype.run=function(e){for(var t=[],r=e.length,n=this._stack.length,i=0;i<r;i++){for(var o=e[i],s=0;s<n&&(o=this._stack[s](o,i,e),void 0!==o&&""!==o);s++);void 0!==o&&""!==o&&t.push(o)}return t},e.Pipeline.prototype.runString=function(e,t){var r=new this.tokenizer(e,t);return this.run(r)},e.Pipeline.prototype.reset=function(){this._stack=[]},e.Pipeline.prototype.toJSON=function(){return this._stack.map(function(t){return e.Pipeline.registeredFunctions[t.label]})},e.Pipeline.prototype.registerFunction=function(t,r){if("function"!=typeof t)throw new Error("Check your maps, you provided a function that is not actually a function");t.label&&e.Pipeline.registeredFunctions[t.label]||(t.label=r||this.serialiseCounter++,e.Pipeline.registeredFunctions[t.label]=t)},e.Pipeline.load=function(t){var r=new e.Pipeline;return t.forEach(function(t){var n=e.Pipeline.registeredFunctions[t];if("function"!=typeof n)throw new Error("Cannot load un-registered function: "+t);r.add(n)}),r},e.tokenizer.prototype=Object.create(null),e.tokenizer.prototype.constructor=e.tokenizer,e.tokenizer.separator=/[ \t\n\r\f\-\(\)]+/,e.tokenizer.prototype.tokenize=function(e,t){if(null==e||void 0==e)return[];if(Array.isArray(e))return e.map(function(e){return new this.Token(e.toLowerCase(),t)});for(var r=e.toString().toLowerCase(),n=r.length,i=0,o=[],s=0,a=0;i<=n;i++){var l=r.charAt(i),u=i-s;if(l.match(this.tokenizer.separator)||i==n){if(u>0){var c=new e.Token(r.slice(s,i),t);c.metadata.position=[s,u],c.metadata.index=a++,o.push(c)}s=i+1}}return o},e.trimmer=function(e,t,r){return e.str=e.str.replace(/^\W+/,"").replace(/\W+$/,""),e},e.Pipeline.registerFunction(e.trimmer,"trimmer"),e.stopWordFilter=function(e,t,r){return e.stopWords.has(e.str)?void 0:e},e.stopWordFilter.stopWords=new e.TokenSet,e.Pipeline.registerFunction(e.stopWordFilter,"stopWordFilter"),e.stemmer=u,e.Pipeline.registerFunction(e.stemmer,"stemmer"),e.WordCharacters="a-zA-Z0-9",e.tokenizer.separator=new RegExp("[^"+e.WordCharacters+"]+"),e.generateStopWordFilter=function(e){var t=e.reduce(function(e,t){return e.add(t),e},new this.TokenSet.Builder);return this.stopWordFilter.stopWords=t.build(),this.stopWordFilter},e.stopWordFilter.stopWords=e.TokenSet.empty,e.trimmer=a,e.Pipeline.registerFunction(e.trimmer,"trimmer"),e.stemmer=u,e.Pipeline.registerFunction(e.stemmer,"stemmer"),e.TokenSet.Builder=function(){this.previous=null,this.root={},this.nextId=0,this.edges={},this.build=function(){var t=new e.TokenSet;return t.edges=this.edges,t.root=this.root,t.nextId=this.nextId,t},this.insert=function(e){var t,r=0;if(this.previous&&this.previous.length<e.length&&this.previous.str==e.str.slice(0,this.previous.length))t=this.previous.node;else{t=this.root;for(var n=0;n<e.str.length&&t[e.str[n]];n++)t=t[e.str[n]],r++;this.previous={str:e.str,node:t}}if(r<e.str.length)for(var i=r;i<e.str.length;i++){var o=e.str[i];t[o]={},t=t[o]}else this.previous=null;return t.final||(t.final=!0,this.edges[this.nextId]={str:e.str,node:t},t.id=this.nextId,this.nextId+=1),t.final}},e.TokenSet.fromArray=function(t){for(var r=new e.TokenSet.Builder,n=0,i=t.length;n<i;n++)r.insert(new e.Token(t[n]));return r.build()},e.TokenSet.fromString=function(t,r){return this.fromArray(t.split(r||this.tokenizer.separator))},e.TokenSet.prototype.fromArray=function(e){for(var t=new this.TokenSet.Builder,r=0;r<e.length;r++)t.insert(e[r]);t.build()},e.TokenSet.prototype.toJSON=function(){return{edges:this.edges,root:this.root,nextId:this.nextId}},e.Query.wildcard=new e.Token("*"),e.Query.wildcard.metadata.wildcard=!0,e.Query.wildcard.str="*";return e}())});}}]);

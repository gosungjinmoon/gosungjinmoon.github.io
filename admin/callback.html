<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>GOFUNWITH OAuth Callback</title>
  <style>
    body { font-family: Pretendard, sans-serif; background: #fafafa; color: #1E2A3A; text-align: center; padding-top: 15%; }
  </style>
</head>
<body>
  <h2>GitHub 로그인 처리 중...</h2>
  <p id="status">잠시만 기다려주세요.</p>

  <script>
    (async () => {
      const code = new URL(window.location.href).searchParams.get("code");
      if (!code) {
        document.getElementById("status").textContent = "❌ code 매개변수가 없습니다.";
        return;
      }

      try {
        const res = await fetch(`https://gfw-oauth-exchange.eric-moon.workers.dev?code=${code}`);
        const data = await res.json();

        if (data.access_token) {
          sessionStorage.setItem("github_token", data.access_token);
          document.getElementById("status").textContent = "✅ 로그인 성공! 관리자 페이지로 이동 중...";
          setTimeout(() => (window.location.href = "/admin/theme-preview.html"), 1500);
        } else {
          document.getElementById("status").textContent = "⚠️ 로그인 실패: " + (data.error || "unknown");
        }
      } catch (err) {
        document.getElementById("status").textContent = "🚫 네트워크 오류: " + err.message;
      }
    })();
  </script>
</body>
</html>

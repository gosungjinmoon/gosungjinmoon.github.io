
<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>GOFUNWITH Admin | Theme Preview</title>
  <link rel="stylesheet" href="../themes/theme-base.css" />
  <link rel="stylesheet" href="../themes/theme-light.css" />
  <link rel="stylesheet" href="../themes/theme-sand.css" />
  <link rel="stylesheet" href="../themes/theme-forest.css" />
  <link rel="stylesheet" href="../themes/theme-ocean.css" />
  <style>
    .theme-card {border:2px solid #ccc;border-radius:8px;padding:1rem;text-align:center;cursor:pointer;}
    .theme-card.active {border-color:#0095ff;box-shadow:0 0 8px rgba(0,149,255,0.4);}
    .status {margin-top:1rem;text-align:center;}
  </style>
</head>
<body>
  <header style="display:flex;justify-content:space-between;align-items:center;padding:1rem;background:#1E2A3A;color:white;">
    <div>GOFUNWITH – Theme Admin</div>
    <button id="loginBtn" style="padding:.5rem 1rem;">Sign in with GitHub</button>
  </header>
  <main>
    <h2 style="text-align:center;">테마 미리보기 & 적용</h2>
    <section style="display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:1rem;padding:1rem;">
      <div class="theme-card" data-theme="light" style="background:#f8f8f8;">🌤 Light</div>
      <div class="theme-card" data-theme="sand" style="background:#F9F5EF;">🏖 Sand</div>
      <div class="theme-card" data-theme="forest" style="background:#F2F5F3;">🌿 Forest</div>
      <div class="theme-card" data-theme="ocean" style="background:#E8F2F8;">🌊 Ocean</div>
    </section>
    <div id="status" class="status">🔍 테마를 클릭하여 미리보거나 변경하세요.</div>
  </main>
  <script>
  document.addEventListener("DOMContentLoaded", async () => {
    const status = document.getElementById("status");
    const cards = document.querySelectorAll(".theme-card");
    const token = sessionStorage.getItem("github_token");
    const REPO = "gosungjinmoon/gosungjinmoon.github.io";
    const FILE_PATH = "config/theme-config.js";
    const BRANCH = "main";

    cards.forEach(card => {
      card.addEventListener("click", async () => {
        const theme = card.dataset.theme;
        cards.forEach(c => c.classList.remove("active"));
        card.classList.add("active");
        document.body.className = "";
        document.body.classList.add(`theme-${theme}`);
        status.textContent = `🎨 ${theme} 테마 미리보기 중...`;

        if (!token) return;

        try {
          const res = await fetch(`https://api.github.com/repos/${REPO}/contents/${FILE_PATH}?ref=${BRANCH}`, {
            headers: { Authorization: `token ${token}` }
          });
          const data = await res.json();
          const newConfig = `window.__GFW_THEME__ = { default: "light", activeTheme: "${theme}", allowUserToggle: false, allowLangToggle: true };`;
          const encoded = btoa(unescape(encodeURIComponent(newConfig)));
          const updateRes = await fetch(`https://api.github.com/repos/${REPO}/contents/${FILE_PATH}`, {
            method: "PUT",
            headers: { "Authorization": `token ${token}`, "Content-Type": "application/json" },
            body: JSON.stringify({ message: `Update theme to ${theme}`, content: encoded, sha: data.sha, branch: BRANCH })
          });
          if (!updateRes.ok) throw new Error("업데이트 실패");
          status.textContent = `✅ ${theme} 테마가 GitHub에 반영되었습니다!`;
        } catch (err) {
          console.error(err);
          status.textContent = "🚫 테마 업데이트 실패: " + err.message;
        }
      });
    });
  });
  </script>
</body>
</html>

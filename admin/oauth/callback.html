<!-- /* admin/oauth/callback.html  v6.4.0_20251018XXXX */ -->
<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="utf-8" />
    <title>OAuth Callback</title>
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <style>
      body { font-family: Inter, system-ui, -apple-system, sans-serif; padding: 20px; }
    </style>
  </head>
  <body>
    <h2>GitHub 로그인 처리 중...</h2>
    <p id="status">잠시만 기다려주세요.</p>
    <script>
      (async () => {
        const code = new URL(location.href).searchParams.get("code");
        if (!code) { document.getElementById("status").textContent = "❌ code 없음"; return; }
        try {
          const worker = "{{ site.data.theme.cloudflare_worker_endpoint }}";
          const res = await fetch(worker + "/api/oauth-exchange", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ code }),
          });
          const data = await res.json();
          if (data.access_token) {
            sessionStorage.setItem("github_token", data.access_token);
            document.getElementById("status").textContent = "✅ 로그인 성공! Admin으로 이동...";
            setTimeout(() => (location.href = "/admin/"), 1000);
          } else {
            document.getElementById("status").textContent = "⚠️ 실패: " + (data.error || "unknown");
          }
        } catch (e) {
          document.getElementById("status").textContent = "🚫 네트워크 오류: " + e.message;
        }
      })();
    </script>
  </body>
</html>

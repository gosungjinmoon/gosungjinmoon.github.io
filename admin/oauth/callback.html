<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>GOFUNWITH OAuth Callback</title>
  <style>
    body { font-family: Pretendard, system-ui, sans-serif; background:#0f172a; color:#e2e8f0; text-align:center; padding-top:15vh; }
    .card { max-width:560px; margin:0 auto; padding:2rem; background:#111827; border-radius:16px; box-shadow:0 20px 50px rgba(0,0,0,.35); }
  </style>
</head>
<body>
  <div class="card">
    <h2>GitHub 로그인 처리 중...</h2>
    <p id="status">잠시만 기다려주세요.</p>
  </div>
  <script>
    (async () => {
      const code = new URL(window.location.href).searchParams.get("code");
      if (!code) {
        document.getElementById("status").textContent = "❌ code 파라미터 없음";
        return;
      }
      try {
        const res = await fetch(`https://gfw-oauth-exchange.eric-moon.workers.dev?code=${code}`);
        const data = await res.json();
        if (data.access_token) {
          sessionStorage.setItem("github_token", data.access_token);
          document.getElementById("status").textContent = "✅ 로그인 성공! 관리자 페이지로 이동 중...";
          setTimeout(() => (window.location.href = "/admin/"), 1000);
        } else {
          document.getElementById("status").textContent = "⚠️ 로그인 실패: " + (data.error_description || data.error || "unknown");
        }
      } catch (e) {
        document.getElementById("status").textContent = "🚫 네트워크 오류: " + e.message;
      }
    })();
  </script>
</body>
</html>

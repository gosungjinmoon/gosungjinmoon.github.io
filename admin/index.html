<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>GoFunWith Admin Console</title>
  <link rel="stylesheet" href="css/admin.css" />
  <style>
    body {
      font-family: Pretendard, sans-serif;
      margin: 0;
      display: flex;
      height: 100vh;
      background: #f7f8fa;
      color: #1e2a3a;
    }
    header.admin-header {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 60px;
      background: #1e2a3a;
      color: white;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 20px;
      z-index: 10;
    }
    .sidebar {
      width: 220px;
      background: #fff;
      border-right: 1px solid #ddd;
      padding-top: 80px;
      box-sizing: border-box;
    }
    .sidebar ul {
      list-style: none;
      padding: 0;
      margin: 0;
    }
    .sidebar li {
      padding: 15px 20px;
      cursor: pointer;
      border-bottom: 1px solid #f0f0f0;
    }
    .sidebar li.active {
      background: #eef3ff;
      font-weight: 600;
      color: #3366ff;
    }
    main {
      flex: 1;
      padding: 80px 30px 40px 250px;
      overflow-y: auto;
    }
    h2 {
      border-bottom: 2px solid #eee;
      padding-bottom: 8px;
      margin-top: 0;
    }
    .card {
      background: #fff;
      border-radius: 10px;
      padding: 20px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.05);
      margin-bottom: 30px;
    }
    .card label {
      display: block;
      font-weight: 600;
      margin-top: 12px;
      margin-bottom: 6px;
    }
    .card input, .card select {
      width: 100%;
      padding: 10px;
      border: 1px solid #ddd;
      border-radius: 6px;
    }
    .actions {
      display: flex;
      justify-content: flex-end;
      margin-top: 20px;
      gap: 10px;
    }
    button {
      padding: 10px 18px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-weight: 600;
    }
    button.primary {
      background: #3366ff;
      color: #fff;
    }
    button.secondary {
      background: #eee;
      color: #333;
    }
    iframe.preview {
      width: 100%;
      height: 400px;
      border: 1px solid #ccc;
      margin-top: 20px;
      border-radius: 6px;
    }
    pre.code {
      background: #fafafa;
      padding: 15px;
      border-radius: 6px;
      border: 1px solid #eee;
      overflow-x: auto;
      font-size: 0.9em;
      color: #333;
    }
  </style>
</head>

<body>
  <!-- 헤더 -->
  <header class="admin-header">
    <h1>⚙️ GoFunWith Admin</h1>
    <div class="spacer"></div>
    <div>
      <button id="loginBtn">GitHub 로그인</button>
      <button id="logoutBtn" class="secondary">로그아웃</button>
    </div>
  </header>

  <!-- 사이드바 -->
  <nav class="sidebar">
    <ul>
      <li data-page="theme" class="active">🎨 테마</li>
      <li data-page="settings">🔧 환경설정</li>
      <li data-page="posts">📝 포스트</li>
      <li data-page="automations">🤖 자동화</li>
    </ul>
  </nav>

  <!-- 메인 컨텐츠 -->
  <main id="content">
    <!-- 🎨 테마 설정 -->
    <section id="page-theme" class="page visible">
      <h2>🎨 테마 설정</h2>
      <div class="card">
        <label>브랜드명</label>
        <input id="brandName" placeholder="GOFUNWITH – Explore. Create. Share." />
        <label>태그라인</label>
        <input id="brandTagline" placeholder="Go have fun with tech, tools, and life." />
        <label>GA4 Measurement ID</label>
        <input id="ga4" placeholder="G-R7N7G7QPBF" />
        <label>n8n Subscribe URL</label>
        <input id="n8n" placeholder="https://n8n.gofunwith.com/webhook/subscribe" />
        <div class="actions">
          <button id="loadTheme">불러오기</button>
          <button id="saveTheme" class="primary">저장 & 커밋</button>
        </div>
      </div>
      <iframe id="preview" src="/" class="preview"></iframe>
    </section>

    <!-- 🔧 환경설정 -->
    <section id="page-settings" class="page" style="display:none;">
      <h2>🔧 환경설정</h2>
      <div class="card">
        <label>기본 언어</label>
        <select id="langDefault">
          <option value="ko">한국어</option>
          <option value="en">English</option>
        </select>
        <label>페이지당 포스트 수</label>
        <input id="postsPerPage" type="number" min="1" value="10" />
        <div class="actions">
          <button id="loadConfig">불러오기</button>
          <button id="saveConfig" class="primary">저장 & 커밋</button>
        </div>
      </div>
    </section>

    <!-- 📝 포스트 관리 -->
    <section id="page-posts" class="page" style="display:none;">
      <h2>📝 포스트 관리</h2>
      <div class="card">
        <p>GitHub 저장소에 직접 포스트를 생성하고 자동 PR을 만드는 기능입니다.</p>

        <div class="actions">
          <button id="listPosts">목록 불러오기</button>
          <button id="createFromTemplate" class="primary">새 글 작성 (PR 생성)</button>
        </div>
        <pre id="postsResult" class="code">목록이 여기에 표시됩니다.</pre>
      </div>
    </section>

    <!-- 🤖 자동화 -->
    <section id="page-automations" class="page" style="display:none;">
      <h2>🤖 자동화</h2>
      <div class="card">
        <p>n8n과 Supabase 연동 상태를 점검할 수 있는 페이지 (v6.4 예정)</p>
      </div>
    </section>
  </main>

  <!-- 스크립트 -->
  <script type="module">
    import { createNewPost } from "./js/posts.js";

    // 페이지 전환
    const navItems = document.querySelectorAll(".sidebar li");
    navItems.forEach((item) => {
      item.addEventListener("click", () => {
        navItems.forEach((el) => el.classList.remove("active"));
        item.classList.add("active");

        document.querySelectorAll("section.page").forEach((sec) => (sec.style.display = "none"));
        document.getElementById(`page-${item.dataset.page}`).style.display = "block";
      });
    });

    // GitHub 로그인 (OAuth)
    const loginBtn = document.getElementById("loginBtn");
    const logoutBtn = document.getElementById("logoutBtn");

    loginBtn.addEventListener("click", () => {
      const clientId = "Ov23liqsljSBAqajz2eu";
      const redirectUri = "https://blog.gofunwith.com/admin/oauth/callback.html";
      window.location.href = `https://github.com/login/oauth/authorize?client_id=${clientId}&scope=repo,user&redirect_uri=${encodeURIComponent(redirectUri)}`;
    });

    logoutBtn.addEventListener("click", () => {
      sessionStorage.removeItem("github_token");
      alert("로그아웃 되었습니다.");
      location.reload();
    });

    // 새 글 생성
    document.getElementById("createFromTemplate").addEventListener("click", createNewPost);
  </script>
</body>
</html>

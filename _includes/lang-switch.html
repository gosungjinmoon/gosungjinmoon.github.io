<!-- _includes/lang-switch.html -->
<div class="lang-switch">
  {% assign current_lang = page.lang | default: 'ko' %}
  {% assign target_lang = current_lang == 'ko' ? 'en' : 'ko' %}

  <button id="langSwitchBtn" type="button" data-target-lang="{{ target_lang }}">
    {{ target_lang == 'ko' ? '한국어' : 'English' }}
  </button>
</div>

<script>
(function(){
  const btn = document.getElementById('langSwitchBtn');
  if(!btn) return;
  btn.addEventListener('click', function(){
    var target = btn.getAttribute('data-target-lang') || 'en';

    // 페이지가 포스트(detail)인지 확인 (Front matter 필요)
    var isPost = !!document.querySelector('article.post');
    if(isPost){
      // 현재 URL이 .../YYYY/MM/DD/slug.lang.html 형태일 때를 기준으로 변환
      var href = window.location.pathname;
      // 파일명 끝의 .ko.html / .en.html 교체
      href = href.replace(/\.ko\.html$|\.en\.html$/i, '.'+target+'.html');
      // 루트에 /en/ prefix가 필요한 경우 처리
      if(target === 'en' && !href.startsWith('/en/')){
        href = '/en' + href;
      } else if(target === 'ko' && href.startsWith('/en/')){
        href = href.replace(/^\/en/, '');
      }
      window.location.href = href;
      return;
    }

    // 목록/홈 등: 루트 전환
    var base = (target === 'en') ? '/en/' : '/';
    window.location.href = base;
  });
})();
</script>
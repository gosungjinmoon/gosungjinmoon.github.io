{%- comment -%}
  ============================================================
  ✅ GOFUNWITH Custom Head (Chirpy 7.4.x Compatible)
  Author: Eric Sungjin Moon
  Purpose: Multi-language support (ko/en) without CSS loss
  ============================================================
{%- endcomment -%}

{%- assign page_lang = page.lang | default: site.lang | default: "ko" -%}
<!DOCTYPE html>
<html lang="{{ page_lang }}">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- =============================
         ✅ SEO & Basic Metadata
         ============================= -->
    <title>
      {%- if page.title -%}
        {{ page.title }} | {{ site.title }}
      {%- else -%}
        {{ site.title }}
      {%- endif -%}
    </title>
    <meta name="description" content="{{ page.description | default: site.description | escape }}">

    <meta name="lang" content="{{ page_lang }}">
    <meta name="author" content="{{ site.social.name | default: 'GOFUNWITH' }}">
    <meta name="generator" content="Jekyll {{ jekyll.version }}">

    <!-- =============================
         ✅ Canonical & SEO Links
         ============================= -->
    <link rel="canonical" href="{{ page.url | absolute_url }}">
    {%- if page.alternate_urls -%}
      {%- for alt in page.alternate_urls -%}
        <link rel="alternate" hreflang="{{ alt.lang }}" href="{{ alt.url | absolute_url }}">
      {%- endfor -%}
    {%- endif -%}

    <!-- =============================
         ✅ Favicon & App Icons
         ============================= -->
    <link rel="icon" href="{{ site.favicon | default: '/assets/img/favicon.svg' }}">
    <link rel="apple-touch-icon" href="{{ site.favicon | default: '/assets/img/favicon.svg' }}">

    <!-- =============================
         ✅ Stylesheets (Chirpy core + custom)
         ============================= -->
    <link rel="stylesheet" href="{{ '/assets/css/style.css' | relative_url }}">
    {%- if site.theme_color -%}
      <meta name="theme-color" content="{{ site.theme_color }}">
    {%- endif -%}

    <!-- =============================
         ✅ Fonts
         ============================= -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&family=Pretendard:wght@400;500;700&display=swap" rel="stylesheet">

    <style>
      body {
        font-family: 'Pretendard', 'Inter', sans-serif;
      }
    </style>

    <!-- =============================
         ✅ Analytics (GA4 / Cloudflare)
         ============================= -->
    {% if site.analytics.google.id %}
      <!-- Google tag (gtag.js) -->
      <script async src="https://www.googletagmanager.com/gtag/js?id={{ site.analytics.google.id }}"></script>
      <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', '{{ site.analytics.google.id }}');
      </script>
    {% endif %}

    {% if site.analytics.cloudflare.id %}
      <script defer src="https://static.cloudflareinsights.com/beacon.min.js"
              data-cf-beacon='{"token": "{{ site.analytics.cloudflare.id }}"}'></script>
    {% endif %}

    <!-- =============================
         ✅ Giscus (Comments)
         ============================= -->
    {% if site.comments.provider == "giscus" %}
      <script src="https://giscus.app/client.js"
        data-repo="{{ site.comments.giscus.repo }}"
        data-repo-id="{{ site.comments.giscus.repo_id }}"
        data-category="{{ site.comments.giscus.category }}"
        data-category-id="{{ site.comments.giscus.category_id }}"
        data-mapping="{{ site.comments.giscus.mapping }}"
        data-reactions-enabled="{{ site.comments.giscus.reactions_enabled }}"
        data-emit-metadata="{{ site.comments.giscus.emit_metadata }}"
        data-input-position="{{ site.comments.giscus.input_position }}"
        data-theme="{{ site.comments.giscus.giscus_theme | default: 'light' }}"
        data-lang="{{ page_lang }}"
        crossorigin="anonymous"
        async>
      </script>
    {% endif %}

    <!-- =============================
         ✅ SEO Tag (Jekyll Plugin)
         ============================= -->
    {% seo %}

    <!-- =============================
         ✅ RSS Feed
         ============================= -->
    {% feed_meta %}

    <!-- =============================
         ✅ Language Switch Support
         ============================= -->
    <script>
      document.addEventListener('DOMContentLoaded', function () {
        const lang = '{{ page_lang }}';
        localStorage.setItem('lang', lang);
      });
    </script>

  </head>
